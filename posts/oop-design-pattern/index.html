<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.121.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="设计模式"><meta itemprop=description content="设计模式"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://cnewbie.github.io/imgs/hugo_next_avatar.png"><meta itemprop=keywords content="python,uml,design pattern"><meta property="og:type" content="article"><meta property="og:title" content="设计模式"><meta property="og:description" content="设计模式"><meta property="og:image" content="/imgs/hugo_next_avatar.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://cnewbie.github.io/posts/oop-design-pattern/"><meta property="og:site_name" content="Hugo NexT Blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="cnewbie"><meta property="article:published_time" content="2019-11-01 08:00:00 +0800 CST"><meta property="article:modified_time" content="2019-11-01 08:00:00 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.613cdd93403a6fc6667e9d7305a30b932cdc5a2fcc77df9f66518c9a9fa56b3c.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"oop-design-pattern","permalink":"https://cnewbie.github.io/posts/oop-design-pattern/","title":"设计模式","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>设计模式 - Hugo NexT Blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Hugo NexT Blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>cnewbie的小窝</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>20</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#创建型模式>创建型模式</a><ul><li><a href=#工厂方法-factory-method>工厂方法 Factory Method</a><ul><li><a href=#意图>意图</a></li><li><a href=#问题>问题</a></li><li><a href=#解决方案>解决方案</a></li><li><a href=#uml-结构>UML 结构</a></li><li><a href=#应用示例>应用示例</a></li><li><a href=#适用性>适用性</a></li><li><a href=#实现步骤>实现步骤</a></li><li><a href=#优缺点>优缺点</a></li></ul></li><li><a href=#抽象工厂-abstract-factory>抽象工厂 Abstract Factory</a><ul><li><a href=#意图-1>意图</a></li><li><a href=#问题-1>问题</a></li><li><a href=#解决方案-1>解决方案</a></li><li><a href=#uml-结构-1>UML 结构</a></li><li><a href=#应用示例-1>应用示例</a></li><li><a href=#适用性-1>适用性</a></li><li><a href=#实现步骤-1>实现步骤</a></li><li><a href=#优缺点-1>优缺点</a></li></ul></li><li><a href=#创建者-builder>创建者 Builder</a><ul><li><a href=#意图-2>意图</a></li><li><a href=#问题-2>问题</a></li><li><a href=#解决方案-2>解决方案</a></li><li><a href=#uml-结构-2>UML 结构</a></li><li><a href=#应用示例-2>应用示例</a></li><li><a href=#适用性-2>适用性</a></li><li><a href=#实现步骤-2>实现步骤</a></li><li><a href=#优缺点-2>优缺点</a></li></ul></li><li><a href=#原型模式>原型模式</a><ul><li><a href=#意图-3>意图</a></li><li><a href=#问题-3>问题</a></li><li><a href=#解决方案-3>解决方案</a></li><li><a href=#uml-结构-3>UML 结构</a></li><li><a href=#应用示例-3>应用示例</a></li><li><a href=#适用性-3>适用性</a></li><li><a href=#实现步骤-3>实现步骤</a></li><li><a href=#优缺点-3>优缺点</a></li></ul></li><li><a href=#单例模式>单例模式</a><ul><li><a href=#意图-4>意图</a></li><li><a href=#问题-4>问题</a></li><li><a href=#解决方案-4>解决方案</a></li><li><a href=#uml-结构-4>UML 结构</a></li><li><a href=#应用示例-4>应用示例</a></li><li><a href=#适用性-4>适用性</a></li><li><a href=#实现步骤-4>实现步骤</a></li><li><a href=#优缺点-4>优缺点</a></li></ul></li></ul></li><li><a href=#结构型模式>结构型模式</a><ul><li><a href=#适配器-adapter>适配器 Adapter</a><ul><li><a href=#意图-5>意图</a></li><li><a href=#问题-5>问题</a></li><li><a href=#解决方案-5>解决方案</a></li><li><a href=#uml-结构-5>UML 结构</a><ul><li><a href=#类适配器>类适配器</a></li></ul></li><li><a href=#应用示例-5>应用示例</a></li><li><a href=#适用性-5>适用性</a></li><li><a href=#实现步骤-5>实现步骤</a></li><li><a href=#优缺点-5>优缺点</a></li></ul></li><li><a href=#桥接模式>桥接模式</a><ul><li><a href=#意图-6>意图</a></li><li><a href=#问题-6>问题</a></li><li><a href=#解决方案-6>解决方案</a></li><li><a href=#uml-结构-6>UML 结构</a></li><li><a href=#应用示例-6>应用示例</a></li><li><a href=#适用性-6>适用性</a></li><li><a href=#实现步骤-6>实现步骤</a></li><li><a href=#优缺点-6>优缺点</a></li></ul></li><li><a href=#组合模式>组合模式</a><ul><li><a href=#意图-7>意图</a></li><li><a href=#问题-7>问题</a></li><li><a href=#解决方案-7>解决方案</a></li><li><a href=#uml-结构-7>UML 结构</a></li><li><a href=#应用示例-7>应用示例</a></li><li><a href=#适用性-7>适用性</a></li><li><a href=#实现步骤-7>实现步骤</a></li><li><a href=#优缺点-7>优缺点</a></li></ul></li><li><a href=#装饰模式>装饰模式</a><ul><li><a href=#意图-8>意图</a></li><li><a href=#问题-8>问题</a></li><li><a href=#解决方案-8>解决方案</a></li><li><a href=#uml-结构-8>UML 结构</a></li><li><a href=#应用示例-8>应用示例</a></li><li><a href=#适用性-8>适用性</a></li><li><a href=#实现步骤-8>实现步骤</a></li><li><a href=#优缺点-8>优缺点</a></li></ul></li><li><a href=#外观模式>外观模式</a><ul><li><a href=#意图-9>意图</a></li><li><a href=#问题-9>问题</a></li><li><a href=#解决方案-9>解决方案</a></li><li><a href=#uml-结构-9>UML 结构</a></li><li><a href=#应用示例-9>应用示例</a></li><li><a href=#适用性-9>适用性</a></li><li><a href=#实现步骤-9>实现步骤</a></li><li><a href=#优缺点-9>优缺点</a></li></ul></li><li><a href=#享元模式>享元模式</a><ul><li><a href=#意图-10>意图</a></li><li><a href=#问题-10>问题</a></li><li><a href=#解决方案-10>解决方案</a></li><li><a href=#uml-结构-10>UML 结构</a></li><li><a href=#应用示例-10>应用示例</a></li><li><a href=#适用性-10>适用性</a></li><li><a href=#实现步骤-10>实现步骤</a></li><li><a href=#优缺点-10>优缺点</a></li></ul></li><li><a href=#代理模式>代理模式</a><ul><li><a href=#意图-11>意图</a></li><li><a href=#问题-11>问题</a></li><li><a href=#解决方案-11>解决方案</a></li><li><a href=#uml-结构-11>UML 结构</a></li><li><a href=#应用示例-11>应用示例</a></li><li><a href=#适用性-11>适用性</a></li><li><a href=#实现步骤-11>实现步骤</a></li><li><a href=#优缺点-11>优缺点</a></li></ul></li></ul></li><li><a href=#行为模式>行为模式</a><ul><li><a href=#责任链模式>责任链模式</a><ul><li><a href=#意图-12>意图</a></li><li><a href=#问题-12>问题</a></li><li><a href=#解决方案-12>解决方案</a></li><li><a href=#uml-结构-12>UML 结构</a></li><li><a href=#应用示例-12>应用示例</a></li><li><a href=#适用性-12>适用性</a></li><li><a href=#实现步骤-12>实现步骤</a></li><li><a href=#优缺点-12>优缺点</a></li></ul></li><li><a href=#命令模式>命令模式</a><ul><li><a href=#意图-13>意图</a></li><li><a href=#问题-13>问题</a></li><li><a href=#解决方案-13>解决方案</a></li><li><a href=#uml-结构-13>UML 结构</a></li><li><a href=#应用示例-13>应用示例</a></li><li><a href=#适用性-13>适用性</a></li><li><a href=#实现步骤-13>实现步骤</a></li><li><a href=#优缺点-13>优缺点</a></li></ul></li><li><a href=#迭代器模式>迭代器模式</a><ul><li><a href=#意图-14>意图</a></li><li><a href=#问题-14>问题</a></li><li><a href=#解决方案-14>解决方案</a></li><li><a href=#uml-结构-14>UML 结构</a></li><li><a href=#应用示例-14>应用示例</a></li><li><a href=#适用性-14>适用性</a></li><li><a href=#实现步骤-14>实现步骤</a></li><li><a href=#优缺点-14>优缺点</a></li></ul></li><li><a href=#中介者模式>中介者模式</a><ul><li><a href=#意图-15>意图</a></li><li><a href=#问题-15>问题</a></li><li><a href=#解决方案-15>解决方案</a></li><li><a href=#uml-结构-15>UML 结构</a></li><li><a href=#应用示例-15>应用示例</a></li><li><a href=#适用性-15>适用性</a></li><li><a href=#实现步骤-15>实现步骤</a></li><li><a href=#优缺点-15>优缺点</a></li></ul></li><li><a href=#备忘录模式>备忘录模式</a><ul><li><a href=#意图-16>意图</a></li><li><a href=#问题-16>问题</a></li><li><a href=#解决方案-16>解决方案</a></li><li><a href=#uml-结构-16>UML 结构</a><ul><li><a href=#基于嵌套类实现>基于嵌套类实现</a></li><li><a href=#基于接口实现>基于接口实现</a></li><li><a href=#严格封装>严格封装</a></li></ul></li><li><a href=#应用示例-16>应用示例</a></li><li><a href=#适用性-16>适用性</a></li><li><a href=#实现步骤-16>实现步骤</a></li><li><a href=#优缺点-16>优缺点</a></li></ul></li><li><a href=#观察者模式>观察者模式</a><ul><li><a href=#意图-17>意图</a></li><li><a href=#问题-17>问题</a></li><li><a href=#解决方案-17>解决方案</a></li><li><a href=#uml-结构-17>UML 结构</a></li><li><a href=#应用示例-17>应用示例</a></li><li><a href=#适用性-17>适用性</a></li><li><a href=#实现步骤-17>实现步骤</a></li><li><a href=#优缺点-17>优缺点</a></li></ul></li><li><a href=#状态模式>状态模式</a><ul><li><a href=#意图-18>意图</a></li><li><a href=#问题-18>问题</a></li><li><a href=#解决方案-18>解决方案</a></li><li><a href=#uml-结构-18>UML 结构</a></li><li><a href=#应用示例-18>应用示例</a></li><li><a href=#适用性-18>适用性</a></li><li><a href=#实现步骤-18>实现步骤</a></li><li><a href=#优缺点-18>优缺点</a></li></ul></li><li><a href=#策略模式>策略模式</a><ul><li><a href=#意图-19>意图</a></li><li><a href=#问题-19>问题</a></li><li><a href=#解决方案-19>解决方案</a></li><li><a href=#uml-结构-19>UML 结构</a></li><li><a href=#应用示例-19>应用示例</a></li><li><a href=#适用性-19>适用性</a></li><li><a href=#实现步骤-19>实现步骤</a></li><li><a href=#优缺点-19>优缺点</a></li></ul></li><li><a href=#模版方法模式>模版方法模式</a><ul><li><a href=#意图-20>意图</a></li><li><a href=#问题-20>问题</a></li><li><a href=#解决方案-20>解决方案</a></li><li><a href=#uml-结构-20>UML 结构</a></li><li><a href=#应用示例-20>应用示例</a></li><li><a href=#适用性-20>适用性</a></li><li><a href=#实现步骤-20>实现步骤</a></li><li><a href=#优缺点-20>优缺点</a></li></ul></li><li><a href=#访问者模式>访问者模式</a><ul><li><a href=#意图-21>意图</a></li><li><a href=#问题-21>问题</a></li><li><a href=#解决方案-21>解决方案</a></li><li><a href=#uml-结构-21>UML 结构</a></li><li><a href=#应用示例-21>应用示例</a></li><li><a href=#适用性-21>适用性</a></li><li><a href=#实现步骤-21>实现步骤</a></li><li><a href=#优缺点-21>优缺点</a></li></ul></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=cnewbie src=/imgs/img-lazy-loading.gif data-src=/imgs/hugo_next_avatar.png><p class=site-author-name itemprop=name>cnewbie</p><div class=site-description itemprop=description>KISS</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>20</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>1</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>35</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/cnewbie title="Github → https://github.com/cnewbie" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://github.com/hugo-next/hugo-theme-next title=https://github.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2017-04-12T08:36:54+08:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=79417></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=170></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2024-01-18T10:13:10+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/cnewbie rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://cnewbie.github.io/posts/oop-design-pattern/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/hugo_next_avatar.png"><meta itemprop=name content="cnewbie"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="cnewbie"><meta itemprop=description content="KISS"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="设计模式"><meta itemprop=description content="设计模式"></span><header class=post-header><h1 class=post-title itemprop="name headline">设计模式</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2019-11-01 08:00:00 +0800 CST" itemprop="dateCreated datePublished" datetime="2019-11-01 08:00:00 +0800 CST">2019-11-01
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/tech itemprop=url rel=index><span itemprop=name>tech</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>15171</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>31分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/posts/oop-design-pattern/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>面向对象之设计模式</p><h1 id=创建型模式>创建型模式
<a class=header-anchor href=#%e5%88%9b%e5%bb%ba%e5%9e%8b%e6%a8%a1%e5%bc%8f></a></h1><p>创建型模式提供了创建对象的机制， 能够提升已有代码的灵活性和可复用性。</p><h2 id=工厂方法-factory-method>工厂方法 Factory Method
<a class=header-anchor href=#%e5%b7%a5%e5%8e%82%e6%96%b9%e6%b3%95-factory-method></a></h2><h3 id=意图>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be></a></h3><p>父类中提供创建对象的接口，但是允许子类修改需要创建对象的类型</p><h3 id=问题>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98></a></h3><p>创建物流管理类，起先实现了火车类，随着业务的增长，需要进行水路运输。
在修改物流管理类时，需要修改所有运输的代码。</p><h3 id=解决方案>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88></a></h3><p>工厂方法通过调用特殊的工厂方法替代直接使用构造方法构建对象，通过工厂方法返回的对象称之为产品。</p><h3 id=uml-结构>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Product{
</span></span><span style=display:flex><span>    -doStuff()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteProductA{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteProductB{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Creator{
</span></span><span style=display:flex><span>    +someOperation()
</span></span><span style=display:flex><span>    +createProduct(): Product
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteCreatorA{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteCreatorB{
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ConcreteProductA ..|&gt; Product
</span></span><span style=display:flex><span>ConcreteProductB ..|&gt; Product
</span></span><span style=display:flex><span>ConcreteCreatorA --|&gt; Creator
</span></span><span style=display:flex><span>ConcreteCreatorB --|&gt; Creator
</span></span><span style=display:flex><span>Creator --&gt; Product
</span></span></code></pre></div><ul><li>Product 抽象产品接口</li><li>ConcreteProduct 产品类</li><li>Creator 抽象工厂方法，依赖抽象产品接口</li><li>ConcreteCreator 工厂方法</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/factory-method/structure.png alt="factory method"></p><h3 id=应用示例>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b></a></h3><p>多平台 UI 元素</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Button</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>render</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>on_click</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WindowsButton</span>(Button):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>render</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>on_click</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;click&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LinuxButton</span>(Button):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>render</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>on_click</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;click&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dialog</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>render</span>(self):
</span></span><span style=display:flex><span>        ok_button <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>create_button()
</span></span><span style=display:flex><span>        ok_button<span style=color:#f92672>.</span>on_click()
</span></span><span style=display:flex><span>        ok_button<span style=color:#f92672>.</span>render()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_button</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WindowsDialog</span>(Dialog):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_button</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> WindowsButton()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LinuxDialog</span>(Dialog):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_butoon</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> LinuxButton()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    dailog <span style=color:#f92672>=</span> WindowsDialog()
</span></span><span style=display:flex><span>    dailog<span style=color:#f92672>.</span>render()
</span></span></code></pre></div><h3 id=适用性>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7></a></h3><ul><li>事先不知道应使用对象的确切类型和依赖关系</li><li>为库或框架提供内部组件拓展</li><li>重用已存在对象而不是每次新建对象，以节约系统资源</li></ul><h3 id=实现步骤>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4></a></h3><ol><li>创建所有产品的接口</li><li>创建者中添加空的工厂方法，返回类型为抽象产品</li><li>将创建者代码中所有产品构造函数引用处替换成工厂方法，并将产品创建代码提取到工厂方法中</li><li>构造创建者子类对象，复写工厂方法</li><li>如果基类工厂方法为空，可以声明为抽象方法</li></ol><h3 id=优缺点>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9></a></h3><ul><li><input checked disabled type=checkbox> 解耦创建者和产品</li><li><input checked disabled type=checkbox> 单一职责原则</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input disabled type=checkbox> 代码层级复杂</li></ul><h2 id=抽象工厂-abstract-factory>抽象工厂 Abstract Factory
<a class=header-anchor href=#%e6%8a%bd%e8%b1%a1%e5%b7%a5%e5%8e%82-abstract-factory></a></h2><h3 id=意图-1>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-1></a></h3><p>不指定具体工厂类生产一系列相关产品的族</p><h3 id=问题-1>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-1></a></h3><p>生产家具族，具体的家具有不同的变种。如何在不改动原有代码的情况下生产新的产品或族</p><h3 id=解决方案-1>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-1></a></h3><p>首先声明产品族的接口，通过接口衍生处不同的产品；接着声明具有创建产品族的方法抽象工厂；
最后通过抽象工厂衍生具体工厂类，生产需要的产品族。</p><h3 id=uml-结构-1>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-1></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface ProductA
</span></span><span style=display:flex><span>interface ProductB
</span></span><span style=display:flex><span>class ConcreteProductA1
</span></span><span style=display:flex><span>class ConcreteProductA2
</span></span><span style=display:flex><span>class ConcreteProductB1
</span></span><span style=display:flex><span>class ConcreteProductB2
</span></span><span style=display:flex><span>interface AbstractFactory{
</span></span><span style=display:flex><span>    +createProduct(): ProductA
</span></span><span style=display:flex><span>    +createProduct(): ProductB
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteFactory1
</span></span><span style=display:flex><span>class ConcreteFactory2
</span></span><span style=display:flex><span>class Client{
</span></span><span style=display:flex><span>    - factory: AbstractFactory
</span></span><span style=display:flex><span>    + Client(f: AbstractFactory)
</span></span><span style=display:flex><span>    + someOperation()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ConcreteFactory1 ..|&gt; AbstractFactory
</span></span><span style=display:flex><span>ConcreteFactory2 ..|&gt; AbstractFactory
</span></span><span style=display:flex><span>ConcreteProductA1 ..|&gt; ProductA
</span></span><span style=display:flex><span>ConcreteProductA2 ..|&gt; ProductA
</span></span><span style=display:flex><span>ConcreteProductB1 ..|&gt; ProductB
</span></span><span style=display:flex><span>ConcreteProductB2 ..|&gt; ProductB
</span></span><span style=display:flex><span>ConcreteFactory1 ..&gt; ConcreteProductA1
</span></span><span style=display:flex><span>ConcreteFactory1 ..&gt; ConcreteProductB1
</span></span><span style=display:flex><span>ConcreteFactory2 ..&gt; ConcreteProductA2
</span></span><span style=display:flex><span>ConcreteFactory2 ..&gt; ConcreteProductB2
</span></span><span style=display:flex><span>Client o--&gt; AbstractFactory
</span></span></code></pre></div><ul><li>AbstractFactory 抽象工厂接口</li><li>Product 抽象产品</li><li>ConcreteFactory 具体工厂</li><li>ConcreteProduct 具体产品</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/abstract-factory/structure.png alt="abstract factory"></p><h3 id=应用示例-1>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-1></a></h3><p>跨平台 UI 主题</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Button</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CheckBox</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WinButton</span>(Button):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WinCheckBox</span>(CheckBox):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Button</span>(Button):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CheckBox</span>(CheckBox):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GUIFactory</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_button</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_checkbox</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WinFactory</span>(GUIFactory):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_button</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;button&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> WinButton()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_checkbox</span>(self):
</span></span><span style=display:flex><span>        print(slef<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;checkbox&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> WinCheckBox()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MacFactory</span>(GUIFactory):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_button</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;button&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> MacButton()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_checkbox</span>(self):
</span></span><span style=display:flex><span>        print(slef<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;checkbox&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> MacCheckBox()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, factory):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>factory <span style=color:#f92672>=</span> factory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_ui</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>button <span style=color:#f92672>=</span> factory<span style=color:#f92672>.</span>create_button()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    factory <span style=color:#f92672>=</span> WinFactory()
</span></span><span style=display:flex><span>    app <span style=color:#f92672>=</span> Application(factory)
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>create_ui()
</span></span></code></pre></div><h3 id=适用性-1>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-1></a></h3><ul><li>需要生产一系列相关产品族，但是不希望具体类依赖这些产品</li></ul><h3 id=实现步骤-1>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-1></a></h3><ol><li>抽象处不同产品的类型</li><li>声明抽象产品接口</li><li>声明抽象工厂接口</li><li>实现具体工厂类和具体产品</li><li>创建工厂初始化代码，实例化具体工厂类</li></ol><h3 id=优缺点-1>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-1></a></h3><ul><li><input checked disabled type=checkbox> 确保工厂生产的产品相互匹配</li><li><input checked disabled type=checkbox> 解耦具体工厂与客户端代码</li><li><input checked disabled type=checkbox> 单一职责原则</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input disabled type=checkbox> 代码复杂</li></ul><h2 id=创建者-builder>创建者 Builder
<a class=header-anchor href=#%e5%88%9b%e5%bb%ba%e8%80%85-builder></a></h2><h3 id=意图-2>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-2></a></h3><p>逐步构造复杂的对象，可使用相同的构造代码生成对象的不同类型和表示形式。</p><h3 id=问题-2>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-2></a></h3><p>多步创建复杂对象，如创建房子需要创建车库、花园、游泳池等部分。一种方法是通过房子基类衍生不同的特定子类，
新增参数必须引入多个子类，最终层级过于复杂，另一种方法创建包含选项的构造函数控制生成的对象，使得参数判断变得复杂。</p><h3 id=解决方案-2>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-2></a></h3><p>分解创建过程成不同的步骤的创建者，随后根据需求调用创建者对象。
由于构建复杂，可对用于构建产品的构建器步骤的一系列调用提取到一个单独的指挥类中，
指挥类定义了执行创建步骤的顺序，而创建者提供了这些步骤的实现。</p><h3 id=uml-结构-2>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-2></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Builder{
</span></span><span style=display:flex><span>    + reset()
</span></span><span style=display:flex><span>    + buildStepA()
</span></span><span style=display:flex><span>    + buildStepB()
</span></span><span style=display:flex><span>    + buildStepC()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteBuilder1{
</span></span><span style=display:flex><span>    - result: Product1
</span></span><span style=display:flex><span>    + reset()
</span></span><span style=display:flex><span>    + buildStepA()
</span></span><span style=display:flex><span>    + buildStepB()
</span></span><span style=display:flex><span>    + buildStepC()
</span></span><span style=display:flex><span>    + getResult(): Product1
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class ConcreteBuilder2{
</span></span><span style=display:flex><span>    - result: Product2
</span></span><span style=display:flex><span>    + reset()
</span></span><span style=display:flex><span>    + buildStepA()
</span></span><span style=display:flex><span>    + buildStepB()
</span></span><span style=display:flex><span>    + buildStepC()
</span></span><span style=display:flex><span>    + getResult(): Product2
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Director{
</span></span><span style=display:flex><span>    - builder: Builder
</span></span><span style=display:flex><span>    + Director(builder)
</span></span><span style=display:flex><span>    + changeBuilder(builder)
</span></span><span style=display:flex><span>    + make(type)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ConcreteBuilder1 ..|&gt; Builder
</span></span><span style=display:flex><span>ConcreteBuilder2 ..|&gt; Builder
</span></span><span style=display:flex><span>ConcreteBuilder1 --&gt; Product1
</span></span><span style=display:flex><span>ConcreteBuilder2 --&gt; Product2
</span></span><span style=display:flex><span>Director o--&gt; Builder
</span></span><span style=display:flex><span>Client --&gt; Director
</span></span><span style=display:flex><span>Client --&gt; ConcreteBuilder1
</span></span></code></pre></div><ul><li>Builder 创建者接口</li><li>ConcreteBuilder 具体创建者</li><li>Director 指挥者</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/builder/structure.png alt="builder structure"></p><h3 id=应用示例-2>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-2></a></h3><p>创建多种不同类型的车及其手册，通过创建者分解不同的步骤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Car</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CarManual</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SportEngine</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>reset</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_seats</span>(self, number):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_engine</span>(self, engine):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_trip_computer</span>(self, <span style=color:#f92672>*</span>args):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_gps</span>(self, <span style=color:#f92672>*</span>args):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CarBuilder</span>(Builder):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>reset</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_car <span style=color:#f92672>=</span> Car()
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;reset&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_seats</span>(self, number):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;set seats&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_engine</span>(self, engine):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;set engine&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_trip_computer</span>(self, <span style=color:#f92672>*</span>args):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;set trip computer&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_gps</span>(self, <span style=color:#f92672>*</span>args):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;set gps&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_result</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_car
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CarManualBuilder</span>(Builder):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>reset</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_car_manual <span style=color:#f92672>=</span> CarManual()
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;reset&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_seats</span>(self, number):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;set seats&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_engine</span>(self, engine):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;set engine&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_trip_computer</span>(self, <span style=color:#f92672>*</span>args):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;set trip computer&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_gps</span>(self, <span style=color:#f92672>*</span>args):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;set gps&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_result</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_car_manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Director</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_builder</span>(self, builder):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>builder <span style=color:#f92672>=</span> builder
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>construct_sports_car</span>(self, builder):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> builder:
</span></span><span style=display:flex><span>            builder <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>builder
</span></span><span style=display:flex><span>        builder<span style=color:#f92672>.</span>reset()
</span></span><span style=display:flex><span>        builder<span style=color:#f92672>.</span>set_seats(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        builder<span style=color:#f92672>.</span>set_engine(SportEngine())
</span></span><span style=display:flex><span>        builder<span style=color:#f92672>.</span>set_trip_computer(<span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>        builder<span style=color:#f92672>.</span>set_gps(<span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>construct_SUV</span>(self, builder):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    director <span style=color:#f92672>=</span> Director()
</span></span><span style=display:flex><span>    builder <span style=color:#f92672>=</span> CarBuilder()
</span></span><span style=display:flex><span>    director<span style=color:#f92672>.</span>construct_sports_car(builder)
</span></span><span style=display:flex><span>    car <span style=color:#f92672>=</span> builder<span style=color:#f92672>.</span>get_result()
</span></span><span style=display:flex><span>    manual_builder <span style=color:#f92672>=</span> CarManualBuilder()
</span></span><span style=display:flex><span>    director<span style=color:#f92672>.</span>construct_sports_car(manual_builder)
</span></span><span style=display:flex><span>    manual <span style=color:#f92672>=</span> manual_builder<span style=color:#f92672>.</span>get_result()
</span></span></code></pre></div><h3 id=适用性-2>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-2></a></h3><ul><li>避免多参数构造函数</li><li>构造不同类型的产品</li></ul><h3 id=实现步骤-2>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-2></a></h3><ol><li>确保可抽象出可以创建不同表示产品的共同步骤</li><li>声明创建者接口</li><li>创建具体创建者类，需要实现获取产品类方法，如果产品类型相同可在接口中实现</li><li>创建指挥类</li><li>使用创建类与指挥类</li></ol><h3 id=优缺点-2>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-2></a></h3><ul><li><input checked disabled type=checkbox> 逐步创建复杂对象</li><li><input checked disabled type=checkbox> 重用相同构造代码</li><li><input checked disabled type=checkbox> 单一职责原则</li><li><input disabled type=checkbox> 创建多个类，增加复杂性</li></ul><h2 id=原型模式>原型模式
<a class=header-anchor href=#%e5%8e%9f%e5%9e%8b%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-3>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-3></a></h3><p>不依赖对象类代码复制已存在的对象</p><h3 id=问题-3>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-3></a></h3><p>通过创建新对象遍历对象属性复制的方法，可能会忽略私有属性，导致复制不完全</p><h3 id=解决方案-3>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-3></a></h3><p>原型模式将复制过程委派给被复制的对象，模式声明一个统一的接口，让接口支持复制对象，而无需将代码与对象类耦合。</p><h3 id=uml-结构-3>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-3></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Prototype{
</span></span><span style=display:flex><span>    + clone(): Prototype
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class ConcretePrototype{
</span></span><span style=display:flex><span>    - field1
</span></span><span style=display:flex><span>    + ConcretePrototype(prototype)
</span></span><span style=display:flex><span>    + clone(): Prototype
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class SubclassPrototype{
</span></span><span style=display:flex><span>    - field2
</span></span><span style=display:flex><span>    + SubclassPrototype(prototype)
</span></span><span style=display:flex><span>    + clone(): Prototype
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ConcretePrototype ..|&gt;Prototype
</span></span><span style=display:flex><span>SubclassPrototype --|&gt;ConcretePrototype
</span></span><span style=display:flex><span>Client --&gt; Prototype
</span></span></code></pre></div><ul><li>Prototype 原型接口</li><li>ConcretePtototype 具体原型，实现复制方法</li><li>Client 客户端调用</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/prototype/structure-indexed.png alt="prototype structure"></p><p>原型注册表实现</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Prototype{
</span></span><span style=display:flex><span>    + getColor(): string
</span></span><span style=display:flex><span>    + clone(): Prototype
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class PrototypeRegistry{
</span></span><span style=display:flex><span>    - items: Prototype[]
</span></span><span style=display:flex><span>    + addItem(id: string, p:Prototype)
</span></span><span style=display:flex><span>    + getById(id: string): Prototype
</span></span><span style=display:flex><span>    + getByColor(color: string): Prototype
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Button{
</span></span><span style=display:flex><span>    - x,y,color
</span></span><span style=display:flex><span>    + Button(x,y,color)
</span></span><span style=display:flex><span>    + BUtton(prototype)
</span></span><span style=display:flex><span>    + getColor(): string
</span></span><span style=display:flex><span>    + clone(): Prototype
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Client --&gt; PrototypeRegistry
</span></span><span style=display:flex><span>PrototypeRegistry o--&gt; Prototype
</span></span><span style=display:flex><span>Button ..|&gt; Prototype
</span></span></code></pre></div><p>原型注册表提供了一种访问常用原型的简单方法， 其中存储了一系列可供随时复制的预生成对象。</p><p><a href=https://refactoringguru.cn/design-patterns/prototype/python/example title="python example" rel="noopener external nofollow noreferrer" target=_blank class=exturl>python example
<i class="fa fa-external-link-alt"></i></a></p><h3 id=应用示例-3>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-3></a></h3><p>复制几何对象副本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>abstract class Shape{
</span></span><span style=display:flex><span>    - x, y
</span></span><span style=display:flex><span>    - color
</span></span><span style=display:flex><span>    + Shape(source)
</span></span><span style=display:flex><span>    + clone()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class Recangle{
</span></span><span style=display:flex><span>    - width
</span></span><span style=display:flex><span>    - height
</span></span><span style=display:flex><span>    + Rectangle()
</span></span><span style=display:flex><span>    + clone()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class Circle{
</span></span><span style=display:flex><span>    - radius
</span></span><span style=display:flex><span>    + Circle()
</span></span><span style=display:flex><span>    + clone()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Rectangle --|&gt; Shape
</span></span><span style=display:flex><span>Circle --|&gt; Shape
</span></span><span style=display:flex><span>Application o--&gt; Shape
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Shape</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, x<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, y<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, color<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>x <span style=color:#f92672>=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>y <span style=color:#f92672>=</span> y
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>color <span style=color:#f92672>=</span> color
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>clone</span>(self)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Rectangle</span>(Shape):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, w<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, h<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>w <span style=color:#f92672>=</span> w
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>h <span style=color:#f92672>=</span> h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>clone</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Rectangle(self<span style=color:#f92672>.</span>x, self<span style=color:#f92672>.</span>y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Circle</span>(Shape):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, radius<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>radius <span style=color:#f92672>=</span> radius
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>clone</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Circle(self<span style=color:#f92672>.</span>x)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self):
</span></span><span style=display:flex><span>        circle <span style=color:#f92672>=</span> Circle()
</span></span><span style=display:flex><span>        circle<span style=color:#f92672>.</span>x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        circle<span style=color:#f92672>.</span>y <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>shapes <span style=color:#f92672>=</span> list()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>shapes<span style=color:#f92672>.</span>append(circle)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>shapes<span style=color:#f92672>.</span>append(circle<span style=color:#f92672>.</span>clone())
</span></span><span style=display:flex><span>        rectangle <span style=color:#f92672>=</span> Rectangle()
</span></span><span style=display:flex><span>        rectangle<span style=color:#f92672>.</span>w <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        rectangle<span style=color:#f92672>.</span>h <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>shapes<span style=color:#f92672>.</span>append(rectangle)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>clone_all</span>(self):
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> list()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>shapes:
</span></span><span style=display:flex><span>            ret<span style=color:#f92672>.</span>append(i<span style=color:#f92672>.</span>clone())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    app <span style=color:#f92672>=</span> Application()
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>clone_all()
</span></span></code></pre></div><h3 id=适用性-3>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-3></a></h3><ul><li>需要复制对象，又希望代码独立于对象所属的类</li><li>子类的区别在于对象初始化的方式，可使用该模式减少子类数量</li></ul><h3 id=实现步骤-3>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-3></a></h3><ul><li>创建原型接口，声明克隆方法</li><li>定义额外的构造函数</li><li>实现克隆方法</li><li>可选的丝线注册表类管理常用原型</li></ul><h3 id=优缺点-3>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-3></a></h3><ul><li><input checked disabled type=checkbox> 克隆对象接口具体子类</li><li><input checked disabled type=checkbox> 摆脱重复初始化代码</li><li><input checked disabled type=checkbox> 更方便的生产复杂对象</li><li><input checked disabled type=checkbox> 除继承之外的处理复杂对象预先配置</li><li><input disabled type=checkbox> 复杂对象循环引用问题</li></ul><h2 id=单例模式>单例模式
<a class=header-anchor href=#%e5%8d%95%e4%be%8b%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-4>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-4></a></h3><p>确保类仅有单一的实例，提供全局统一访问入口</p><h3 id=问题-4>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-4></a></h3><ul><li>确保仅有一个实例，常用于限制访问共享资源</li><li>为该实例提供一个全局访问入口</li><li>违反了单一职责原则</li></ul><h3 id=解决方案-4>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-4></a></h3><ul><li>构造函数私有化</li><li>重新定义构造函数并缓存已创建对象</li></ul><h3 id=uml-结构-4>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-4></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Singleton{
</span></span><span style=display:flex><span>    - instance: Singleton
</span></span><span style=display:flex><span>    - Singleton()
</span></span><span style=display:flex><span>    + getInstance(): Singleton
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Client --&gt; Singleton
</span></span></code></pre></div><ul><li>Singleton 单例类：私有化构造函数，定义静态方法</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/singleton/structure-en-indexed.png alt="Singleton structure"></p><h3 id=应用示例-4>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-4></a></h3><p>数据库访问类</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> threading
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SingletonMeta</span>(type):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_instance <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>single_lock <span style=color:#f92672>=</span> Lock()
</span></span><span style=display:flex><span>        super(SingletonMeta, self)<span style=color:#f92672>.</span>__init__(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __call__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> self<span style=color:#f92672>.</span>_local:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>_instance <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>_instance <span style=color:#f92672>=</span> super(SingletonMeta, self)<span style=color:#f92672>.</span>__call__(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_instance
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Database</span>(metaclass<span style=color:#f92672>=</span>SingletonMeta):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>query</span>(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self, args, kwargs))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Database2</span>(object):
</span></span><span style=display:flex><span>    vars <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    single_lock <span style=color:#f92672>=</span> threading<span style=color:#f92672>.</span>Lock()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __new__(cls, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> cls <span style=color:#f92672>in</span> cls<span style=color:#f92672>.</span>vars:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> cls<span style=color:#f92672>.</span>vars[cls]
</span></span><span style=display:flex><span>        cls<span style=color:#f92672>.</span>single_lock<span style=color:#f92672>.</span>acquire()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> cls <span style=color:#f92672>in</span> cls<span style=color:#f92672>.</span>vars:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> cls<span style=color:#f92672>.</span>vars[cls]
</span></span><span style=display:flex><span>            cls<span style=color:#f92672>.</span>vars[cls] <span style=color:#f92672>=</span> super()<span style=color:#f92672>.</span>__new__(cls, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> cls<span style=color:#f92672>.</span>vars[cls]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>finally</span>:
</span></span><span style=display:flex><span>            cls<span style=color:#f92672>.</span>single_lock<span style=color:#f92672>.</span>release()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>query</span>(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self, args, kwargs))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>(self,  <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        db <span style=color:#f92672>=</span> Database()
</span></span><span style=display:flex><span>        db<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;haha&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        db <span style=color:#f92672>=</span> Database()
</span></span><span style=display:flex><span>        db<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;heihei&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        db <span style=color:#f92672>=</span> Database2()
</span></span><span style=display:flex><span>        db<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;haha2&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        db <span style=color:#f92672>=</span> Database2()
</span></span><span style=display:flex><span>        db<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;heihei2&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    db <span style=color:#f92672>=</span> Database()
</span></span><span style=display:flex><span>    db<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;haha&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    db <span style=color:#f92672>=</span> Database()
</span></span><span style=display:flex><span>    db<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;heihei&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    db <span style=color:#f92672>=</span> Database2()
</span></span><span style=display:flex><span>    db<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;haha2&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    db <span style=color:#f92672>=</span> Database2()
</span></span><span style=display:flex><span>    db<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;heihei2&#39;</span>)
</span></span></code></pre></div><h3 id=适用性-4>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-4></a></h3><ul><li>程序中类的对于所有客户端只有一个可用实例</li><li>更加严格的控制全局变量</li></ul><h3 id=实现步骤-4>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-4></a></h3><ul><li>私有静态变量</li><li>声明公共静态方法</li><li>延迟初始化</li><li>构造函数私有</li></ul><h3 id=优缺点-4>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-4></a></h3><ul><li><input checked disabled type=checkbox> 确保类实例唯一</li><li><input checked disabled type=checkbox> 全局访问入口</li><li><input checked disabled type=checkbox> 延迟加载</li><li><input disabled type=checkbox> 违反单一职责原则</li><li><input disabled type=checkbox> 多线程环境需要加锁</li></ul><h1 id=结构型模式>结构型模式
<a class=header-anchor href=#%e7%bb%93%e6%9e%84%e5%9e%8b%e6%a8%a1%e5%bc%8f></a></h1><p>结构型模式介绍如何将对象和类组装成较大的结构， 并同时保持结构的灵活和高效。</p><h2 id=适配器-adapter>适配器 Adapter
<a class=header-anchor href=#%e9%80%82%e9%85%8d%e5%99%a8-adapter></a></h2><h3 id=意图-5>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-5></a></h3><p>使不兼容的对象能够相互兼容</p><h3 id=问题-5>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-5></a></h3><p>原有的 XML 接口现在需要对接 JSON 接口，可以修改现有代码库实现，可能核心库未提供源代码，无法修改如何处理？</p><h3 id=解决方案-5>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-5></a></h3><p>使用一个适配器对象转换接口，使接口能够兼容。</p><p>适配器不仅能够转换不同格式的数据，其次还有助于采用不同接口的对象之间的合作</p><h3 id=uml-结构-5>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-5></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface ClientInterface{
</span></span><span style=display:flex><span>    + method(data)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Adapter{
</span></span><span style=display:flex><span>    - adaptee: Service
</span></span><span style=display:flex><span>    + method(data)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Service{
</span></span><span style=display:flex><span>    + serviceMethod(specialData)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>Client --&gt; ClientInterface
</span></span><span style=display:flex><span>Adapter ..|&gt; ClientInterface
</span></span><span style=display:flex><span>Adapter o--&gt; Service
</span></span></code></pre></div><ul><li>ClientInterface 客户端接口，抽象协议</li><li>Service 服务，不兼容接口</li><li>Adapter 适配器，处理接口数据</li></ul><p>客户端代码与具体适配器代码解耦，方便修改增加新的适配而不修改代码。</p><h4 id=类适配器>类适配器
<a class=header-anchor href=#%e7%b1%bb%e9%80%82%e9%85%8d%e5%99%a8></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>class OlderClass{
</span></span><span style=display:flex><span>    + method(data)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Service{
</span></span><span style=display:flex><span>    + serviceMethod(specialData)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Adapter{
</span></span><span style=display:flex><span>    + method(data)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Client --&gt; OlderClass
</span></span><span style=display:flex><span>Adapter --|&gt; OlderClass
</span></span><span style=display:flex><span>Adapter --|&gt; Service
</span></span></code></pre></div><p>多继承语言支持，类适配器不需要封装对象，同时继承客户端和服务端的行为，重写需要的方法即可。</p><h3 id=应用示例-5>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-5></a></h3><p>不同材料的兼容，方钉和圆孔</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class RoundHole{
</span></span><span style=display:flex><span>    - radius: int
</span></span><span style=display:flex><span>    + RoundHole(radius: int)
</span></span><span style=display:flex><span>    + getRadius(): int
</span></span><span style=display:flex><span>    + fits(peg: RoundPeg): bool
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class RoundPeg{
</span></span><span style=display:flex><span>    - radius: int
</span></span><span style=display:flex><span>    + RoundPeg(radius: int)
</span></span><span style=display:flex><span>    + getRadius(): int
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class SquarePegAdapter{
</span></span><span style=display:flex><span>    - peg: SquarePeg
</span></span><span style=display:flex><span>    + SquarePegAdapter(peg: SquarePeg)
</span></span><span style=display:flex><span>    + getRadius(): int
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class SquarePeg{
</span></span><span style=display:flex><span>    - width: int
</span></span><span style=display:flex><span>    +SquarePeg(width: int)
</span></span><span style=display:flex><span>    + getWidth(): int
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>RoundHole --&gt; RoundPeg
</span></span><span style=display:flex><span>SquarePegAdapter --|&gt; RoundPeg
</span></span><span style=display:flex><span>SquarePeg &lt;|--o SquarePegAdapter
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RoundHole</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, radius):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_radius <span style=color:#f92672>=</span> radius
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_radius</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_radius
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>fits</span>(self, peg):
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>get_radius() <span style=color:#f92672>&gt;=</span> peg<span style=color:#f92672>.</span>get_radius()
</span></span><span style=display:flex><span>        print(ret)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RoundPeg</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, radius):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_radius <span style=color:#f92672>=</span> radius
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_radius</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_radius
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SquarePeg</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, width):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_width <span style=color:#f92672>=</span> width
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_width</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_width
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SquarePegAdapter</span>(RoundPeg):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, peg):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_peg <span style=color:#f92672>=</span> peg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_radius</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> math<span style=color:#f92672>.</span>sqrt(self<span style=color:#f92672>.</span>_peg<span style=color:#f92672>.</span>get_width()) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    hole <span style=color:#f92672>=</span> RoundHole(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>    rpeg <span style=color:#f92672>=</span> RoundPeg(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>    hole<span style=color:#f92672>.</span>fits(rpeg)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    s_sqpeg <span style=color:#f92672>=</span> SquarePeg(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>    l_sqpeg <span style=color:#f92672>=</span> SquarePeg(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e># hole.fits(s_sqpeg)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    s_sqpeg_adapter <span style=color:#f92672>=</span> SquarePegAdapter(s_sqpeg)
</span></span><span style=display:flex><span>    l_sqpeg_adapter <span style=color:#f92672>=</span> SquarePegAdapter(l_sqpeg)
</span></span><span style=display:flex><span>    hole<span style=color:#f92672>.</span>fits(s_sqpeg_adapter)
</span></span><span style=display:flex><span>    hole<span style=color:#f92672>.</span>fits(l_sqpeg_adapter)
</span></span></code></pre></div><h3 id=适用性-5>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-5></a></h3><ul><li>希望使用不兼容的接口类时</li><li>希望复用多个缺少相同功能而无法被添加到父类的子类时</li></ul><h3 id=实现步骤-5>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-5></a></h3><ul><li>确保有两个类接口不兼容</li><li>声明客户端协议接口</li><li>创建具体的适配类</li><li>在适配器中保存需要适配的对象</li><li>实现兼容方法</li></ul><h3 id=优缺点-5>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-5></a></h3><ul><li>单一职责原则</li><li>开闭原则</li><li>代码整体复杂度增加</li></ul><h2 id=桥接模式>桥接模式
<a class=header-anchor href=#%e6%a1%a5%e6%8e%a5%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-6>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-6></a></h3><p>将大类或一系列相关的类炒粉为抽象和实现两个层次结构，可在开发中独立使用</p><h3 id=问题-6>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-6></a></h3><p>不同的几何图形配合不同的颜色，如果再新增不同的图形，需要新增多个颜色的不同子类</p><h3 id=解决方案-6>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-6></a></h3><p>通过抽取颜色纬度为独立层次，使初始类中引用这个层次的对象，从而使得一个类不必用所有的状态和行为。</p><p>抽象常成为接口是一些实体的高层控制层，不做具体工作，将工作委派给实现层</p><h3 id=uml-结构-6>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-6></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Abstraction{
</span></span><span style=display:flex><span>  - i: Implementation
</span></span><span style=display:flex><span>  + feature1()
</span></span><span style=display:flex><span>  + feature2()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>interface Implementation{
</span></span><span style=display:flex><span>  + method1()
</span></span><span style=display:flex><span>  + method2()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class ConcreteImplementations
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ConcreteImplementations ..|&gt; Implementation
</span></span><span style=display:flex><span>Abstraction o--&gt; Implementation
</span></span><span style=display:flex><span>Client --&gt; Abstraction
</span></span><span style=display:flex><span>RefinedAbstraction --|&gt; Abstraction
</span></span></code></pre></div><ul><li>Abstraction 抽象部分控制逻辑</li><li>Implementation 实现部分声明通用接口</li><li>ConcreteImplementations 具体实现</li><li>RefinedAbstraction 具体抽象</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/bridge/structure-en-indexed.png alt="bridge structure"></p><h3 id=应用示例-6>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-6></a></h3><p>设备与遥控器应用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Remote{
</span></span><span style=display:flex><span>  - device: Device
</span></span><span style=display:flex><span>  + togglePower()
</span></span><span style=display:flex><span>  + volumeDown()
</span></span><span style=display:flex><span>  + volumeUp()
</span></span><span style=display:flex><span>  + channelDown()
</span></span><span style=display:flex><span>  + channelUp()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>interface Device{
</span></span><span style=display:flex><span>  + isEnabled()
</span></span><span style=display:flex><span>  + enable()
</span></span><span style=display:flex><span>  + disable()
</span></span><span style=display:flex><span>  + getVolume()
</span></span><span style=display:flex><span>  + setVolume(percent)
</span></span><span style=display:flex><span>  + getChannel()
</span></span><span style=display:flex><span>  + setChannel(channel)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Radio
</span></span><span style=display:flex><span>class TV
</span></span><span style=display:flex><span>class AdvancedRemote
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Radio ..|&gt; Device
</span></span><span style=display:flex><span>TV ..|&gt; Device
</span></span><span style=display:flex><span>AdvancedRemote --|&gt; Remote
</span></span><span style=display:flex><span>Client --&gt; Remote
</span></span></code></pre></div><p>遥控基类声明了一个设备对象的引用，所有遥控器通过通用设备接口与设备进行交互，使得遥控器可以支持不同类型的设备</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RemoteControl</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, device):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_device <span style=color:#f92672>=</span> device
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>toggle_power</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;switch power&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>is_enable():
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>disable()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>enable()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>volume_down</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;volume down&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>volume <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>volume <span style=color:#f92672>-</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>volume_up</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;volume up&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>volume <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>volume <span style=color:#f92672>+</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>channel_down</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;channel down&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>channel <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>channel <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>channel_up</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;channel up&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>channel <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>channel <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AdvancedRemoteControl</span>(RemoteControl):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>mute</span>(self):
</span></span><span style=display:flex><span>        slef<span style=color:#f92672>.</span>_device<span style=color:#f92672>.</span>volume <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Device</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, status<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, volume<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>, channel<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_status <span style=color:#f92672>=</span> status
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_volume <span style=color:#f92672>=</span> volume
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_channel <span style=color:#f92672>=</span> channel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_enable</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>enable</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_status <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>disable</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_status <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>volume</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_volume
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@volume.setter</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>volume</span>(self, v):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_volume <span style=color:#f92672>=</span> v
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>channel</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_channel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@channel.setter</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>channel</span>(self, v):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_channel <span style=color:#f92672>=</span> v
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TV</span>(Device):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Radio</span>(Device):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tv <span style=color:#f92672>=</span> TV()
</span></span><span style=display:flex><span>remote <span style=color:#f92672>=</span> RemoteControl(tv)
</span></span><span style=display:flex><span>remote<span style=color:#f92672>.</span>toggle_power()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>radio <span style=color:#f92672>=</span> Radio()
</span></span><span style=display:flex><span>remote <span style=color:#f92672>=</span> AdvancedRemoteControl(radio)
</span></span><span style=display:flex><span>remote<span style=color:#f92672>.</span>volume_down()
</span></span></code></pre></div><h3 id=适用性-6>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-6></a></h3><ul><li>需要拆分重组一个具有多重功能的类</li><li>需要在几个独立纬度拓展一个类</li><li>在运行时切换不同的实现方法</li></ul><h3 id=实现步骤-6>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-6></a></h3><ul><li>明确类中独立的纬度</li><li>定义抽象类</li><li>确认平台可用操作，声明抽象接口</li><li>平台类实现接口</li><li>抽象类中添加实现类型的引用</li></ul><h3 id=优缺点-6>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-6></a></h3><ul><li><input checked disabled type=checkbox> 创建与平台无关的类</li><li><input checked disabled type=checkbox> 客户端代码与高层抽象互动</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input checked disabled type=checkbox> 单一职责原则</li><li><input disabled type=checkbox> 高内聚类使用该方法可能会更复杂</li></ul><h2 id=组合模式>组合模式
<a class=header-anchor href=#%e7%bb%84%e5%90%88%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-7>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-7></a></h3><p>将对象组合成树状结构，并能像独立对象一样使用它们</p><h3 id=问题-7>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-7></a></h3><p>计算订单时，需要去除产品的包装后，再计算订单总金额，计算需要去除包装等因素</p><h3 id=解决方案-7>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-7></a></h3><p>组合模式建议使用一个通用接口来与包装和产品交互，并且再该接口中声明一个计算总价的方法</p><h3 id=uml-结构-7>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-7></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Component{
</span></span><span style=display:flex><span>  + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Leaf{
</span></span><span style=display:flex><span>  + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Composite{
</span></span><span style=display:flex><span>   - children: Component[]
</span></span><span style=display:flex><span>   + add(c: Component)
</span></span><span style=display:flex><span>   + remove(c: Component)
</span></span><span style=display:flex><span>   + getChildren(): Component[]
</span></span><span style=display:flex><span>   + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>Leaf ..|&gt; Component
</span></span><span style=display:flex><span>Composite ..|&gt; Component
</span></span><span style=display:flex><span>Client --&gt; Component
</span></span></code></pre></div><ul><li>Component 组件 抽象接口描述共同操作</li><li>Leaf 树节点</li><li>Composite 组合 包含也节点的单位</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/composite/structure-en-indexed.png alt="composite structure"></p><h3 id=应用示例-7>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-7></a></h3><p>图形编辑器实现一系列图形, 组合图形包含多个子图形，组合图形自身不完成具体工作，将请求传递给自己的子部件，然后合成结果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Graphic{
</span></span><span style=display:flex><span>  + move(x, y)
</span></span><span style=display:flex><span>  + draw()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Dot{
</span></span><span style=display:flex><span>  + Dot(x, y)
</span></span><span style=display:flex><span>  + move(x, y)
</span></span><span style=display:flex><span>  + draw()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Circle{
</span></span><span style=display:flex><span>  radius
</span></span><span style=display:flex><span>  + Circle(x, y, radius)
</span></span><span style=display:flex><span>  + draw()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class CompoundGraphic{
</span></span><span style=display:flex><span>  - children: Graphic[]
</span></span><span style=display:flex><span>  + add(child: Graphic)
</span></span><span style=display:flex><span>  + remove(child: Graphic)
</span></span><span style=display:flex><span>  + move(x, y)
</span></span><span style=display:flex><span>  + draw()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ImageEditor
</span></span><span style=display:flex><span>ImageEditor --&gt; Graphic
</span></span><span style=display:flex><span>Dot ..|&gt; Graphic
</span></span><span style=display:flex><span>CompoundGraphic ..|&gt; Graphic
</span></span><span style=display:flex><span>Circle --|&gt; Dot
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Graphic</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>move</span>(self, x, y):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>draw</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dot</span>(Graphic):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, x, y):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_x <span style=color:#f92672>=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_y <span style=color:#f92672>=</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>move</span>(self, x, y):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_x <span style=color:#f92672>+=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_y <span style=color:#f92672>+=</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>draw</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;draw graphic&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Circle</span>(Dot):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, x, y, radius):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__(x, y)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_raidus <span style=color:#f92672>=</span> radius
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>draw</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;draw Circle&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CompoundGraphic</span>(Graphic):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_children <span style=color:#f92672>=</span> list()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add</span>(self, child):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_children<span style=color:#f92672>.</span>append(child)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>remove</span>(self, child):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_children<span style=color:#f92672>.</span>remove(child)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>move</span>(self, x, y):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>_children:
</span></span><span style=display:flex><span>            i<span style=color:#f92672>.</span>move(x, y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>draw</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>_children:
</span></span><span style=display:flex><span>            i<span style=color:#f92672>.</span>draw()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ImageEditor</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cg <span style=color:#f92672>=</span> CompoundGraphic()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cg<span style=color:#f92672>.</span>add(Dot(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cg<span style=color:#f92672>.</span>add(Circle(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>group_selected</span>(self, components):
</span></span><span style=display:flex><span>        group <span style=color:#f92672>=</span> CompoundGraphic()
</span></span><span style=display:flex><span>        group<span style=color:#f92672>.</span>add(components)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cg<span style=color:#f92672>.</span>add(group)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cg<span style=color:#f92672>.</span>draw()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    ie <span style=color:#f92672>=</span> ImageEditor()
</span></span><span style=display:flex><span>    ie<span style=color:#f92672>.</span>load()
</span></span><span style=display:flex><span>    ie<span style=color:#f92672>.</span>group_selected(Dot(<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>))
</span></span></code></pre></div><h3 id=适用性-7>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-7></a></h3><ul><li>需要实现树状对象结构</li><li>希望客户端以相同的方式处理简单和复杂的元素</li></ul><h3 id=实现步骤-7>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-7></a></h3><ul><li>确保核心模型能分解成简单元素和容器</li><li>声明组件接口以及一系列方法</li><li>创建一个也节点类表示简单元素</li><li>创建一个组合类表示容器的复杂元素。用于储存子元素</li><li>在容器中定义添加和删除子元素的方法</li></ul><h3 id=优缺点-7>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-7></a></h3><ul><li>利用多态和递归机制方便使用复杂树结构</li><li>开闭原则</li><li>对于功能差异大的类，提供公共结构或许会有困难</li></ul><h2 id=装饰模式>装饰模式
<a class=header-anchor href=#%e8%a3%85%e9%a5%b0%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-8>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-8></a></h3><p>通过对象放入包含行为的特殊封装对象中来为原对象绑定新的行为</p><h3 id=问题-8>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-8></a></h3><p>通知类中可以发送通知，后续需要增加不同的接受终端和通知方式，如果修改源代码会使代码量快速膨胀和复杂</p><h3 id=解决方案-8>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-8></a></h3><p>通过装饰器将目标对象的方法进行拓展，而不改变结构名称与参数。上述问题可以实现基类装饰器后，衍生出不同终端和通知方式的装饰器。</p><h3 id=uml-结构-8>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-8></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Component{
</span></span><span style=display:flex><span>  + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteComponent{
</span></span><span style=display:flex><span>  + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class BaseDecorator{
</span></span><span style=display:flex><span>  - wrappee: Component
</span></span><span style=display:flex><span>  + Decorator(c: Component)
</span></span><span style=display:flex><span>  + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteDecorators{
</span></span><span style=display:flex><span>  + execute()
</span></span><span style=display:flex><span>  + extra()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>Client --&gt; Component
</span></span><span style=display:flex><span>ConcreteComponent ..|&gt; Component
</span></span><span style=display:flex><span>BaseDecorator ..|&gt; Component
</span></span><span style=display:flex><span>ConcreteDecorators --|&gt; BaseDecorator
</span></span></code></pre></div><ul><li>Component 部件 装饰器和被装饰对象的公共接口</li><li>ConcreteComponent 具体部件 被装饰对象</li><li>BaseDecorator 基类装饰器 通用装饰器接口</li><li>ConcreteDecorators 动态添加行为，改变原有被装饰对象行为</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoringguru.cn/images/patterns/diagrams/decorator/structure-indexed.png alt="decorator structure"></p><h3 id=应用示例-8>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-8></a></h3><p>装饰模式加密数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface DataSource{
</span></span><span style=display:flex><span>  + writeData(data)
</span></span><span style=display:flex><span>  + readData()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class FileDataSource{
</span></span><span style=display:flex><span>  - filename
</span></span><span style=display:flex><span>  + FileDataSource(filename)
</span></span><span style=display:flex><span>  + writeData(data)
</span></span><span style=display:flex><span>  - readData()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class DataSourceDecorator{
</span></span><span style=display:flex><span>  - wrappee: DataSource
</span></span><span style=display:flex><span>  + DataSourceDecorator(s:DataSource)
</span></span><span style=display:flex><span>  + writeData(data)
</span></span><span style=display:flex><span>  + readData()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class EncryptionDecorator{
</span></span><span style=display:flex><span>  + writeData(data)
</span></span><span style=display:flex><span>  + readData()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class CompresionDecorator{
</span></span><span style=display:flex><span>  + writeData(data)
</span></span><span style=display:flex><span>  + readData()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>FileDataSource ..|&gt; DataSource
</span></span><span style=display:flex><span>DataSourceDecorator ..|&gt; DataSource
</span></span><span style=display:flex><span>EncryptionDecorator --|&gt; DataSourceDecorator
</span></span><span style=display:flex><span>CompressionDecorator --|&gt; DataSourceDecorator
</span></span><span style=display:flex><span>DataSourceDecorator o--&gt; DataSource
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DataSource</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write_data</span>(self, data):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read_data</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileDataSource</span>(DataSource):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, filename):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_filename <span style=color:#f92672>=</span> filename
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write_data</span>(self, data):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;write data&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read_data</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;read data&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DataSourceDecorator</span>(DataSource):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, wrappee):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_wrappee <span style=color:#f92672>=</span> wrappee
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write_data</span>(self, data):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;decorator write data&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_wrappee<span style=color:#f92672>.</span>write_data(data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read_data</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;decorator read data&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_wrappee<span style=color:#f92672>.</span>read_data()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EncryptionDecorator</span>(DataSourceDecorator):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write_data</span>(self, data):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;encrypt data&#39;</span>)
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>write_data(data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read_data</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;decrypt data&#39;</span>)
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>read_data()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CompressionDecorator</span>(DataSourceDecorator):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write_data</span>(self, data):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;compress data&#39;</span>)
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>write_data(data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read_data</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;decompress data&#39;</span>)
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>read_data()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    source <span style=color:#f92672>=</span> FileDataSource(<span style=color:#e6db74>&#39;haha&#39;</span>)
</span></span><span style=display:flex><span>    source<span style=color:#f92672>.</span>write_data(<span style=color:#e6db74>&#39;abc&#39;</span>)
</span></span><span style=display:flex><span>    c_source <span style=color:#f92672>=</span> CompressionDecorator(source)
</span></span><span style=display:flex><span>    c_source<span style=color:#f92672>.</span>write_data(<span style=color:#e6db74>&#39;abc&#39;</span>)
</span></span><span style=display:flex><span>    e_source <span style=color:#f92672>=</span> EncryptionDecorator(source)
</span></span><span style=display:flex><span>    e_source<span style=color:#f92672>.</span>write_data(<span style=color:#e6db74>&#39;abc&#39;</span>)
</span></span></code></pre></div><h3 id=适用性-8>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-8></a></h3><ul><li>不修改代码的情况下增加对象的功能</li><li>使用继承拓展对象行为难以实现，使用装饰模式</li></ul><h3 id=实现步骤-8>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-8></a></h3><ul><li>确保业务逻辑可用一个基本组件和多个额外可选组件表示</li><li>找出通用方法，声明接口</li><li>创建一个具体组件类，定义基础行为</li><li>创建装饰基类，使用一个成员变量储存被装饰对象</li><li>确保所有类实现组件接口</li><li>将装饰基类拓展为具体装饰类，添加额外行为</li></ul><h3 id=优缺点-8>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-8></a></h3><ul><li>无需新建子类即可拓展对象行为</li><li>运行时添加或删除对象的功能</li><li>多个装饰器组合几种行为</li><li>单一职责原则</li><li>装饰器删除特定装饰器比较困难</li><li>实现行为不受装饰顺序装饰比较困难</li><li>各层初始化配置代码比较糟糕</li></ul><h2 id=外观模式>外观模式
<a class=header-anchor href=#%e5%a4%96%e8%a7%82%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-9>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-9></a></h3><p>使复杂类提供一个简单的接口</p><h3 id=问题-9>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-9></a></h3><p>代码中使用复杂的库或框架中对象，需要负责所有对象的初始化工作、管理其依赖关系并正确执行。将业务逻辑和第三方类的实现耦合，使代码难以维护。</p><h3 id=解决方案-9>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-9></a></h3><p>外观模式为许多部件的复杂子系统提供一个简单的接口，不关心内部实现，仅调用需要的功能。</p><h3 id=uml-结构-9>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-9></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Facade{
</span></span><span style=display:flex><span>  - linkToSubsystemObjects
</span></span><span style=display:flex><span>  - optionalAdditionFacade
</span></span><span style=display:flex><span>  + subsystemOperation()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class AdditionalFacade{
</span></span><span style=display:flex><span>  + anotherOperation()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>class Subsystem
</span></span><span style=display:flex><span>Client --&gt; Facade
</span></span><span style=display:flex><span>Facade --&gt; AdditionalFacade
</span></span><span style=display:flex><span>Facade ..&gt; Subsystem
</span></span><span style=display:flex><span>AdditionalFacade ..&gt; Subsystem
</span></span></code></pre></div><ul><li>Facade 外观 提供特定子系统功能便捷访问</li><li>AdditionalFacade 附加外观 避免多种不相关的功能污染单一外观</li><li>Subsystem 复杂子系统</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoringguru.cn/images/patterns/diagrams/facade/structure-indexed.png alt="facade structure"></p><h3 id=应用示例-9>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-9></a></h3><p>视频转换框架</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Application
</span></span><span style=display:flex><span>class VideoConverter{
</span></span><span style=display:flex><span>  + converVideo(filename, format)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class AudioMixer
</span></span><span style=display:flex><span>class VideoFile
</span></span><span style=display:flex><span>class CodecFactory
</span></span><span style=display:flex><span>Application --&gt; VideoConverter
</span></span><span style=display:flex><span>VideoConverter ..&gt; VideoFile
</span></span><span style=display:flex><span>VideoConverter ..&gt; AudioMixer
</span></span><span style=display:flex><span>VideoConverter ..&gt; CodecFactory
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VideoFile</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, filename<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>filename <span style=color:#f92672>=</span> filename
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;init&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CodecFactory</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>extract</span>(file_<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;CodecFactory extract&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VideoConverter</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>convert</span>(self, filename):
</span></span><span style=display:flex><span>        file_ <span style=color:#f92672>=</span> VideoFile(filename)
</span></span><span style=display:flex><span>        source_codec <span style=color:#f92672>=</span> CodecFactory<span style=color:#f92672>.</span>extract(file_)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> source_codec
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    convertor <span style=color:#f92672>=</span> VideoConverter()
</span></span><span style=display:flex><span>    mp4 <span style=color:#f92672>=</span> convertor<span style=color:#f92672>.</span>convert(<span style=color:#e6db74>&#39;adfd&#39;</span>)
</span></span></code></pre></div><h3 id=适用性-9>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-9></a></h3><ul><li>需要一个复杂子系统的直接接口，且该接口功能有限</li><li>需要将子系统组织为多层结构，减少子系统之间的耦合</li></ul><h3 id=实现步骤-9>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-9></a></h3><ul><li>确认能否在现有子系统的基础上提供一个更简单的接口</li><li>在外观类中声明并实现接口</li><li>确保所有客户端代码仅通过外观模式与子系统进行交互</li></ul><h3 id=优缺点-9>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-9></a></h3><ul><li>可以让代码独立与复杂子系统</li><li>外观可能成为与程序中所有类耦合的类对象</li></ul><h2 id=享元模式>享元模式
<a class=header-anchor href=#%e4%ba%ab%e5%85%83%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-10>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-10></a></h3><p>享元模式通过共享对象状态，在有限的内存中保存更多的对象</p><h3 id=问题-10>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-10></a></h3><p>对象过多造成内存不足，程序崩溃</p><h3 id=解决方案-10>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-10></a></h3><p>对象的常量数据通常被称为固有属性， 其位于对象中， 其他对象只能读取但不能修改其数值。 而对象的其他状态常常能被其他对象 “从外部” 改变， 因此被称为外在属性。</p><p>享元模式建议不在对象中存储外在状态， 而是将其传递给依赖于它的一个特殊方法。 程序只在对象中保存固有属性， 以方便在不同情景下重用。</p><h3 id=uml-结构-10>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-10></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class FlyweightFactory{
</span></span><span style=display:flex><span>    - cache: Flyweight[]
</span></span><span style=display:flex><span>    + getFlyweight(repeationState)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Flyweight{
</span></span><span style=display:flex><span>    - repeatingState
</span></span><span style=display:flex><span>    + operation(uniqueState)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Context{
</span></span><span style=display:flex><span>    - unniqueState
</span></span><span style=display:flex><span>    - flyweight
</span></span><span style=display:flex><span>    + Context(repeatingState, uniqueState)
</span></span><span style=display:flex><span>    + opeartion()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>Client *--&gt; Context
</span></span><span style=display:flex><span>Context --&gt; Flyweight
</span></span><span style=display:flex><span>Context --&gt; FlyweightFactory
</span></span></code></pre></div><ul><li>Flyweight 享元类固有属性</li><li>FlyweightFactory 工厂类</li><li>Context 外在属性类</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/flyweight/structure.png alt="flyweight structure"></p><h3 id=应用示例-10>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-10></a></h3><p>储存多个树对象</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class TreeType{
</span></span><span style=display:flex><span>    - name
</span></span><span style=display:flex><span>    - color
</span></span><span style=display:flex><span>    - texture
</span></span><span style=display:flex><span>    + TreeType(name, color, texture)
</span></span><span style=display:flex><span>    + draw(canvas, x, y)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Tree{
</span></span><span style=display:flex><span>    + x
</span></span><span style=display:flex><span>    + y
</span></span><span style=display:flex><span>    + type: TreeType
</span></span><span style=display:flex><span>    + draw(canvas)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Forest{
</span></span><span style=display:flex><span>    + tree: Tree[]
</span></span><span style=display:flex><span>    + plantTree(x, y, name, color, texture): Tree
</span></span><span style=display:flex><span>    + draw(canvans)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class TreeFactory{
</span></span><span style=display:flex><span>    - treeTypes: TreeType[]
</span></span><span style=display:flex><span>    + getTreeType(name, color, texture)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>TreeFactory o--&gt; TreeType
</span></span><span style=display:flex><span>Tree --&gt; Treetype
</span></span><span style=display:flex><span>Tree --&gt; TreeFactory
</span></span><span style=display:flex><span>Forest o--&gt; Tree
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding:utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TreeType</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, name, color, texture):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>name <span style=color:#f92672>=</span> name
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>color <span style=color:#f92672>=</span> color
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>texture <span style=color:#f92672>=</span> texture
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>draw</span>(self, canvas, x, y):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;tree type draw&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TreeFactory</span>(object):
</span></span><span style=display:flex><span>    tree_types <span style=color:#f92672>=</span> list()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_tree</span>(trees, target):
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> trees:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> trees:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> target:
</span></span><span style=display:flex><span>                ret <span style=color:#f92672>=</span> i
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_tree_type</span>(name, color, texture):
</span></span><span style=display:flex><span>        tree_type <span style=color:#f92672>=</span> TreeFactory<span style=color:#f92672>.</span>find_tree(
</span></span><span style=display:flex><span>            TreeFactory<span style=color:#f92672>.</span>tree_types, (name, color, texture))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> tree_type:
</span></span><span style=display:flex><span>            tree_type <span style=color:#f92672>=</span> TreeType(name, color, texture)
</span></span><span style=display:flex><span>            TreeFactory<span style=color:#f92672>.</span>tree_types<span style=color:#f92672>.</span>append(tree_type)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> tree_type
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Tree</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, x, y, t):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>x <span style=color:#f92672>=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>y <span style=color:#f92672>=</span> y
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>t <span style=color:#f92672>=</span> t
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>draw</span>(self, canvas):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>t<span style=color:#f92672>.</span>draw(canvas, self<span style=color:#f92672>.</span>x, self<span style=color:#f92672>.</span>y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Forest</span>(object):
</span></span><span style=display:flex><span>    trees <span style=color:#f92672>=</span> list()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>plant_tree</span>(self, x, y, name, color, texture):
</span></span><span style=display:flex><span>        t <span style=color:#f92672>=</span> TreeFactory<span style=color:#f92672>.</span>get_tree_type(name, color, texture)
</span></span><span style=display:flex><span>        tree <span style=color:#f92672>=</span> Tree(x, y, t)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>trees<span style=color:#f92672>.</span>append(tree)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>draw</span>(self, canvas):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> tree <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>trees:
</span></span><span style=display:flex><span>            tree<span style=color:#f92672>.</span>draw(canvas)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    forest <span style=color:#f92672>=</span> Forest()
</span></span><span style=display:flex><span>    forest<span style=color:#f92672>.</span>plant_tree(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;tree&#39;</span>, <span style=color:#e6db74>&#39;red&#39;</span>, <span style=color:#e6db74>&#39;p&#39;</span>)
</span></span><span style=display:flex><span>    forest<span style=color:#f92672>.</span>draw(<span style=color:#e6db74>&#39;canvas&#39;</span>)
</span></span></code></pre></div><h3 id=适用性-10>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-10></a></h3><ul><li>当程序使用需要大量对象，并且内存不足的情况</li></ul><h3 id=实现步骤-10>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-10></a></h3><ul><li>分离类属性至两个部分，固有属性；外在属性</li><li>类中不可变的保留固有属性成员变量</li><li>找到所耦外在转台成员变量方法，使用参数替代成员变量</li><li>可选的实现工厂类管理享元缓存池</li><li>客户端必须储存和计算外在状态的数值</li></ul><h3 id=优缺点-10>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-10></a></h3><ul><li><input checked disabled type=checkbox> 节省内存</li><li><input disabled type=checkbox> 牺牲速度换取内存</li><li><input disabled type=checkbox> 代码复杂</li></ul><h2 id=代理模式>代理模式
<a class=header-anchor href=#%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-11>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-11></a></h3><p>代理模式控制原始对象的访问，并允许在将请求提交给对象前后进行一些处理。</p><h3 id=问题-11>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-11></a></h3><p>大量消耗系统资源的对象，实现懒加载，类中可能存在重复的代码。但对于不能修改代码第三方库，不能实现懒加载。</p><h3 id=解决方案-11>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-11></a></h3><p>创建一个新的代理类，将操作委托给代理类，可以真实操作前后执行某些操作。</p><h3 id=uml-结构-11>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-11></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface ServiceInterface{
</span></span><span style=display:flex><span>    + opeartion()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Proxy{
</span></span><span style=display:flex><span>    - realService: Service
</span></span><span style=display:flex><span>    + Proxy(s: Service)
</span></span><span style=display:flex><span>    + checkAccess()
</span></span><span style=display:flex><span>    + operation()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Service{
</span></span><span style=display:flex><span>    + operation
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Proxy ..|&gt; ServiceInterface
</span></span><span style=display:flex><span>Service ..|&gt; ServiceInterface
</span></span><span style=display:flex><span>Proxy o--&gt; Service
</span></span></code></pre></div><ul><li>ServiceInterface 抽象接口</li><li>Proxy 代理类</li><li>Service 真实逻辑类</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/proxy/structure.png alt="proxy structure"></p><h3 id=应用示例-11>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-11></a></h3><p>视频懒加载与缓存</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>interface YoutubeLib{
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> listVideos()
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> getVideoInfo(id)
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> downloadVideo(id)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> YoutubeVideo{
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> listVides()
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> getVideoInfo(id)
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> downloadVideo(id)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> CachedVideo{
</span></span><span style=display:flex><span>    <span style=color:#f92672>-</span> service: YoutubeVideo
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> CachedVideo(s: YoutubeVideo)
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> listVideos()
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> getVideoInfo(id)
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> downloadVideo(id)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>CachedVideo <span style=color:#f92672>..|&gt;</span> YoutubeLib
</span></span><span style=display:flex><span>YoutubeVideo <span style=color:#f92672>..|&gt;</span> YoutubeLib
</span></span><span style=display:flex><span>CachedVideo o<span style=color:#f92672>--&gt;</span> YoutubeVideo
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#! /usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  -*- coding:utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>YoutubeLib</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>list_videos</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_video_info</span>(self, id_):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>download_video</span>(self, id_):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>YoutubeVideo</span>(YoutubeLib):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>list_videos</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;origin list&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_video_info</span>(self, id_):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;id </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> origin info&#39;</span><span style=color:#f92672>.</span>format(id_))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>download_video</span>(self, id_):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;origin download video&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CachedVideo</span>(YoutubeLib):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, service):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>service <span style=color:#f92672>=</span> service
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>list_cache <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>video_cache <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>need_reset <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>list_videos</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> self<span style=color:#f92672>.</span>list_cache <span style=color:#f92672>or</span> self<span style=color:#f92672>.</span>need_reset:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>list_cache <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>service<span style=color:#f92672>.</span>list_videos()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>list_cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_video_info</span>(self, id_):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> self<span style=color:#f92672>.</span>video_cache <span style=color:#f92672>or</span> self<span style=color:#f92672>.</span>need_reset:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>video_cache <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>service<span style=color:#f92672>.</span>get_video_info(id_)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>video_cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>download_video</span>(self, id_):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>need_reset:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>service<span style=color:#f92672>.</span>download_video(id_)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>YoutubeManager</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, service):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>service <span style=color:#f92672>=</span> service
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>render_video_page</span>(self, id_):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>service<span style=color:#f92672>.</span>get_video_info(id_)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>render_list_panel</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>service<span style=color:#f92672>.</span>list_videos()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>react_on_user_input</span>(self, id_):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>render_video_page(id_), self<span style=color:#f92672>.</span>render_list_panel()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    youtube_service <span style=color:#f92672>=</span> YoutubeVideo()
</span></span><span style=display:flex><span>    service_proxy <span style=color:#f92672>=</span> CachedVideo(youtube_service)
</span></span><span style=display:flex><span>    manager <span style=color:#f92672>=</span> YoutubeManager(service_proxy)
</span></span><span style=display:flex><span>    ret <span style=color:#f92672>=</span> manager<span style=color:#f92672>.</span>react_on_user_input(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    print(ret)
</span></span></code></pre></div><h3 id=适用性-11>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-11></a></h3><ul><li>懒加载</li><li>访问控制</li><li>本地执行远程服务</li><li>打印日志</li><li>缓存</li></ul><h3 id=实现步骤-11>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-11></a></h3><ul><li>创建代理与服务的接口，备选的方式是将代理作为服务类的子类</li><li>创建代理类，通常代理负责创建和管理服务</li><li>实现代理方法，委派给服务对象</li><li>创建构造方法判断代理还是服务对象，可以用工厂方法代替</li><li>可选服务对象延迟加载</li></ul><h3 id=优缺点-11>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-11></a></h3><ul><li><input checked disabled type=checkbox> 客户端无感知控制服务对象</li><li><input checked disabled type=checkbox> 可管理服务对象生命周期</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input disabled type=checkbox> 代码复杂</li><li><input disabled type=checkbox> 服务延迟响应</li></ul><h1 id=行为模式>行为模式
<a class=header-anchor href=#%e8%a1%8c%e4%b8%ba%e6%a8%a1%e5%bc%8f></a></h1><p>行为模式负责对象间的高效沟通和职责委派</p><h2 id=责任链模式>责任链模式
<a class=header-anchor href=#%e8%b4%a3%e4%bb%bb%e9%93%be%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-12>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-12></a></h3><p>请求发送至责任链。 收到请求后，每个处理者均可对请求进行处理，或将其传递给链上的下个处理者。</p><h3 id=问题-12>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-12></a></h3><p>在线订单系统，限制非认证用户创建订单，处理认证还需要添加授权、数据验证、缓存等检查，随着功能的增多系统代码越来越复杂。</p><h3 id=解决方案-12>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-12></a></h3><p>责任链会将特定行为转换为被称作 handler 的独立对象，请求与数据传递给 handler 对象处理。</p><p>将多个 handler 串联成链，请求在链上移动并且有计划被 handler 处理。</p><p>最重要的是：handler 可以决定不再沿着链传递请求，这可高效地取消所有后续处理步骤。</p><p>另一种不同的方式为：对于每个请求如果 handler 可以处理就不会在向后传递。</p><h3 id=uml-结构-12>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-12></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Handler{
</span></span><span style=display:flex><span>    + setNext(h: Handler)
</span></span><span style=display:flex><span>    + handle(request)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class BaseHandler{
</span></span><span style=display:flex><span>    - next: Handler
</span></span><span style=display:flex><span>    + setNext(h: Handler)
</span></span><span style=display:flex><span>    + handle(request)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ConcreteHandlers{
</span></span><span style=display:flex><span>    + handle(request)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>BaseHandler ..|&gt; Handler
</span></span><span style=display:flex><span>ConcreteHandlers --|&gt; BaseHandler
</span></span></code></pre></div><ul><li>Handler 处理抽象类</li><li>BaseHandler 基础处理类 定义下一个 handler 指针</li><li>ConcreteHandlers 具体处理类</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/chain-of-responsibility/structure.png alt="chain sturcture"></p><h3 id=应用示例-12>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-12></a></h3><p>GUI 元素显示上下文帮助信息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>interface ComponentWithContextualHelp{
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> showHelp()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> Component{
</span></span><span style=display:flex><span>    <span style=color:#f92672>-</span> container: <span style=color:#a6e22e>Container</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> tooltipText
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> showHelp()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Button</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> Comtainer{
</span></span><span style=display:flex><span>    <span style=color:#f92672>-</span> children: Component
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> add(child)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Panel</span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>-</span> modalHelpText
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> showHelp()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> Dialog{
</span></span><span style=display:flex><span>    <span style=color:#f92672>-</span> wikiPageURL
</span></span><span style=display:flex><span>    <span style=color:#f92672>+</span> showHelp()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Component <span style=color:#f92672>..|&gt;</span> ComponentWithContextualHelp
</span></span><span style=display:flex><span><span style=color:#a6e22e>Container</span> o<span style=color:#f92672>--&gt;</span> Component
</span></span><span style=display:flex><span>Component <span style=color:#f92672>--&gt;</span> <span style=color:#a6e22e>Container</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Container</span> <span style=color:#f92672>--|&gt;</span> Component
</span></span><span style=display:flex><span><span style=color:#a6e22e>Panel</span> <span style=color:#f92672>--&gt;</span> <span style=color:#a6e22e>Container</span>
</span></span><span style=display:flex><span>Dialog <span style=color:#f92672>--&gt;</span> <span style=color:#a6e22e>Container</span>
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/chain-of-responsibility/example-en.png alt="GUI structure"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 责任链抽象接口</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ComponentWithContextualHelp</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>show_help</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 简单组件基础类</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Component</span>(ComponentWithContextualHelp):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, help_text<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>help_text <span style=color:#f92672>=</span> help_text
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>container <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>show_help</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>help_text:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;component help&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>container<span style=color:#f92672>.</span>help()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 容器类包含组件或其他容器</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Container</span>(Component):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>children <span style=color:#f92672>=</span> list()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add</span>(self, child):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>children<span style=color:#f92672>.</span>append(child)
</span></span><span style=display:flex><span>        child<span style=color:#f92672>.</span>container <span style=color:#f92672>=</span> self
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Button</span>(Component):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Panel</span>(Container):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, help_text<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>help_text <span style=color:#f92672>=</span> help_text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>show_help</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>help_text:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;modal_text&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            super()<span style=color:#f92672>.</span>show_help()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dialog</span>(Container):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, help_text<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>help_text <span style=color:#f92672>=</span> help_text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>show_help</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>help_text:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;dialog text&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            super()<span style=color:#f92672>.</span>show_help()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    dialog <span style=color:#f92672>=</span> Dialog(<span style=color:#e6db74>&#39;haha&#39;</span>)
</span></span><span style=display:flex><span>    panel <span style=color:#f92672>=</span> Panel(<span style=color:#e6db74>&#39;panel&#39;</span>)
</span></span><span style=display:flex><span>    button <span style=color:#f92672>=</span> Button(<span style=color:#e6db74>&#39;button&#39;</span>)
</span></span><span style=display:flex><span>    button1 <span style=color:#f92672>=</span> Button(<span style=color:#e6db74>&#39;button1&#39;</span>)
</span></span><span style=display:flex><span>    panel<span style=color:#f92672>.</span>add(button)
</span></span><span style=display:flex><span>    panel<span style=color:#f92672>.</span>add(button1)
</span></span><span style=display:flex><span>    dialog<span style=color:#f92672>.</span>add(panel)
</span></span><span style=display:flex><span>    dialog<span style=color:#f92672>.</span>show_help()
</span></span></code></pre></div><h3 id=适用性-12>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-12></a></h3><ul><li>程序需要不同处理方式处理不同种类的请求，而且请求类型和顺序位置</li><li>必须按顺序执行处理者</li><li>如果处理者及其顺序必须在运行是改变，可以使用该模式</li></ul><h3 id=实现步骤-12>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-12></a></h3><ul><li>声明处理者接口并描述请求处理方法</li><li>为了精简代码可以在处理者接口穿件抽象处理者基类</li><li>依次创建集体处理者代码</li><li>客户端可自行组装责任链，或独立工厂类获取</li></ul><h3 id=优缺点-12>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-12></a></h3><ul><li><input checked disabled type=checkbox> 控制请求处理顺序</li><li><input checked disabled type=checkbox> 单一职责原则</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input disabled type=checkbox> 部分请求可能未处理</li></ul><h2 id=命令模式>命令模式
<a class=header-anchor href=#%e5%91%bd%e4%bb%a4%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-13>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-13></a></h3><p>将请求转换为一个包含与请求相关的所有信息的独立对象。</p><h3 id=问题-13>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-13></a></h3><p>定义文本编辑器基类抽象按钮，为了实现功能具体化多个按钮，修改按钮基类使影响所有子类。除了按钮如快捷键等行为代码如何处理。</p><h3 id=解决方案-13>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-13></a></h3><p>优良的软件设计通常会将关注点分离，即常用的软件分层。如编辑软件分离 GUI 与业务逻辑。命令模式将所有操作进行抽象成命令类，通过命令对象负责连接不同的 GUI 和业务逻辑对象。</p><p>命令模式使用数据对命令对象进行配置，实现不同请求参数。</p><h3 id=uml-结构-13>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-13></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Invoker{
</span></span><span style=display:flex><span>    - command
</span></span><span style=display:flex><span>    + setCommand(command)
</span></span><span style=display:flex><span>    + executeCommand()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>interface Command{
</span></span><span style=display:flex><span>    + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Command1{
</span></span><span style=display:flex><span>    - receiver
</span></span><span style=display:flex><span>    - params
</span></span><span style=display:flex><span>    + Command1(receiver, params)
</span></span><span style=display:flex><span>    + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Receiver
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>Invoker o--&gt; Command
</span></span><span style=display:flex><span>Command1 ..|&gt; Command
</span></span><span style=display:flex><span>Client --&gt; Invoker
</span></span><span style=display:flex><span>Client --&gt; Command1
</span></span><span style=display:flex><span>Client --&gt; Receiver
</span></span></code></pre></div><ul><li>Invoker 调用者 初始化请求</li><li>Command 抽象命令类</li><li>Command1 具体命令类</li><li>Receiver 接受者 处理业务逻辑</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/command/structure.png alt="command structure"></p><h3 id=应用示例-13>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-13></a></h3><p>命令模式实现命令历史与撤销</p><p>有些命令会改变编辑器的状态 （例如剪切和粘贴），它们可在执行相关操作前对编辑器的状态进行备份。命令执行后会和当前点备份的编辑器状态一起被放入命令历史 （命令对象栈）。 此后，如果用户需要进行回滚操作，程序可从历史记录中取出最近的命令，读取相应的编辑器状态备份，然后进行恢复。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Command{
</span></span><span style=display:flex><span>    - app
</span></span><span style=display:flex><span>    - editor
</span></span><span style=display:flex><span>    - backup
</span></span><span style=display:flex><span>    + Command(app, editor)
</span></span><span style=display:flex><span>    + saveBackup
</span></span><span style=display:flex><span>    + undo
</span></span><span style=display:flex><span>    + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Buttons
</span></span><span style=display:flex><span>class Shortcuts
</span></span><span style=display:flex><span>class CommandHistory{
</span></span><span style=display:flex><span>    - history: Command[]
</span></span><span style=display:flex><span>    + push(c: Command)
</span></span><span style=display:flex><span>    + pop(): Command
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class CopyCommand{
</span></span><span style=display:flex><span>    + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class CutCommand{
</span></span><span style=display:flex><span>    + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class PasteCommand{
</span></span><span style=display:flex><span>    + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class UndoCommand{
</span></span><span style=display:flex><span>    + execute()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Editor{
</span></span><span style=display:flex><span>    + text
</span></span><span style=display:flex><span>    + getSelection()
</span></span><span style=display:flex><span>    + deleteSelection()
</span></span><span style=display:flex><span>    + replaceSelection(text)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Application{
</span></span><span style=display:flex><span>    + editors: Editor[]
</span></span><span style=display:flex><span>    + activeEditor: Editor
</span></span><span style=display:flex><span>    + clipboard
</span></span><span style=display:flex><span>    + history: CommandHistory
</span></span><span style=display:flex><span>    + createUI()
</span></span><span style=display:flex><span>    + executeCommand)c: Command)
</span></span><span style=display:flex><span>    + undo
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Application o--&gt; Editor
</span></span><span style=display:flex><span>Application o--&gt; CommandHistory
</span></span><span style=display:flex><span>Application --&gt; Buttons
</span></span><span style=display:flex><span>Application --&gt; Shortcuts
</span></span><span style=display:flex><span>Buttons o--&gt; Command
</span></span><span style=display:flex><span>Shortcuts o--&gt; Command
</span></span><span style=display:flex><span>CommandHistory o--&gt; Command
</span></span><span style=display:flex><span>CopyCommand --|&gt; Command
</span></span><span style=display:flex><span>CutCommand --|&gt; Command
</span></span><span style=display:flex><span>PasteCommand --|&gt; Command
</span></span><span style=display:flex><span>UndoCommand --|&gt; Command
</span></span><span style=display:flex><span>CopyCommand --&gt; Editor
</span></span><span style=display:flex><span>CutCommand --&gt; Editor
</span></span><span style=display:flex><span>PasteCommand --&gt; Editor
</span></span><span style=display:flex><span>UndoCommand --&gt; Application
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/command/example.png alt="command example"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 命令</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Command</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, app, editor):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>app <span style=color:#f92672>=</span> app
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>editor <span style=color:#f92672>=</span> editor
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>backup <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>save_backup</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>backup <span style=color:#f92672>=</span> editor<span style=color:#f92672>.</span>text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CopyCommand</span>(Command):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;execute&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>app<span style=color:#f92672>.</span>clipboard <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>editor<span style=color:#f92672>.</span>get_selection()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CutCommand</span>(Command):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;execute&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>save_backup()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>app<span style=color:#f92672>.</span>clipboard <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>editor<span style=color:#f92672>.</span>get_selection()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>editor<span style=color:#f92672>.</span>delete_selection()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PasteCommand</span>(Command):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;execute&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>save_backup()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>editor<span style=color:#f92672>.</span>repalce_selection(self<span style=color:#f92672>.</span>app<span style=color:#f92672>.</span>clipboard)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UndoCommand</span>(Command):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self):
</span></span><span style=display:flex><span>        print(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;execute&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>app<span style=color:#f92672>.</span>undo()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CommandHistory</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>history <span style=color:#f92672>=</span> list()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>push</span>(self, c):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>history<span style=color:#f92672>.</span>append(c)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pop</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>history<span style=color:#f92672>.</span>pop()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 接受者</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Editor</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>text <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_selection</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;editor get selection&#39;</span>)
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>text:
</span></span><span style=display:flex><span>            ret <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>text
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>delete_selection</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;editor delete selection&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Button</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, command<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>command <span style=color:#f92672>=</span> command
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_command</span>(self, command):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>command <span style=color:#f92672>=</span> command
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>command:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>command()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 发送者</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>clipboard <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>editors <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>active_editor <span style=color:#f92672>=</span> Editor()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>history <span style=color:#f92672>=</span> CommandHistory()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_ui</span>(self, buttons):
</span></span><span style=display:flex><span>        copy_button, undo_button <span style=color:#f92672>=</span> buttons
</span></span><span style=display:flex><span>        copy <span style=color:#f92672>=</span> <span style=color:#66d9ef>lambda</span> : self<span style=color:#f92672>.</span>execute_command(
</span></span><span style=display:flex><span>                CopyCommand(self, self<span style=color:#f92672>.</span>active_editor))
</span></span><span style=display:flex><span>        copy_button<span style=color:#f92672>.</span>set_command(copy)
</span></span><span style=display:flex><span>        undo <span style=color:#f92672>=</span> <span style=color:#66d9ef>lambda</span> : self<span style=color:#f92672>.</span>execute_command(
</span></span><span style=display:flex><span>                UndoCommand(self, self<span style=color:#f92672>.</span>active_editor))
</span></span><span style=display:flex><span>        undo_button<span style=color:#f92672>.</span>set_command(undo)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute_command</span>(self, command):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> command<span style=color:#f92672>.</span>execute():
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>push(command)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>undo</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>history<span style=color:#f92672>.</span>history:
</span></span><span style=display:flex><span>            command <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>history<span style=color:#f92672>.</span>pop()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> command:
</span></span><span style=display:flex><span>                command<span style=color:#f92672>.</span>undo()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_buttons</span>(self, buttons):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> buttons:
</span></span><span style=display:flex><span>            i<span style=color:#f92672>.</span>execute()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    app <span style=color:#f92672>=</span> Application()
</span></span><span style=display:flex><span>    copy_button <span style=color:#f92672>=</span> Button()
</span></span><span style=display:flex><span>    undo_button <span style=color:#f92672>=</span> Button()
</span></span><span style=display:flex><span>    buttons <span style=color:#f92672>=</span> (copy_button, undo_button)
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>create_ui(buttons)
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>test_buttons(buttons)
</span></span></code></pre></div><p>TODO</p><h3 id=适用性-13>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-13></a></h3><ul><li>通过操作来参数化对象，将特定的方法调用转化为独立对象。</li><li>想要将操作放入队列中、 操作的执行或者远程执行操作</li><li>想要实现操作回滚功能</li></ul><h3 id=实现步骤-13>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-13></a></h3><ul><li>声明仅有一个执行方法的抽象命令接口</li><li>具体命令类实现抽象接口，类必须保存请求参数与接受者</li><li>实现命令发送者类，类中保存命令的成员变量</li><li>修改发送者使其执行命令，而非直接将请求发送给接收者</li><li>顺序初始化对象：接受者、创建命令、关联命令与发送者</li></ul><h3 id=优缺点-13>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-13></a></h3><ul><li><input checked disabled type=checkbox> 单一职责</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input checked disabled type=checkbox> 实现撤销与恢复</li><li><input checked disabled type=checkbox> 实现延迟操作</li><li><input checked disabled type=checkbox> 将一组简单命令组合成复杂命令</li><li><input disabled type=checkbox> 代码复杂</li></ul><h2 id=迭代器模式>迭代器模式
<a class=header-anchor href=#%e8%bf%ad%e4%bb%a3%e5%99%a8%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-14>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-14></a></h3><p>不暴露集合底层数据表现形式的情况下遍历集合中所有的元素</p><h3 id=问题-14>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-14></a></h3><p>将遍历方法写入集合类中会造成代码复杂，并且不符合高效存储的设计理念</p><h3 id=解决方案-14>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-14></a></h3><p>迭代器模式的主要思想是将集合的遍历行为抽取为单独的迭代器对象。</p><p>迭代器提供获取集合元素的基础方法，通过调用方法遍历集合所有元素。</p><p>迭代器实现相同的接口，如果需要新的迭代方式，按照需求新建新的迭代器类，无需修改集合代码。</p><h3 id=uml-结构-14>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-14></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Iterator{
</span></span><span style=display:flex><span>    + getNext()
</span></span><span style=display:flex><span>    + hasMore(): bool
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>interface IterableCollextion{
</span></span><span style=display:flex><span>    + createIterator(): Iterator
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteIterator{
</span></span><span style=display:flex><span>    - collection: ConcreteCollection
</span></span><span style=display:flex><span>    - iterationState
</span></span><span style=display:flex><span>    + ConcreteIterator(c: ConcreteCollection)
</span></span><span style=display:flex><span>    + getNext()
</span></span><span style=display:flex><span>    + hasMore(): bool
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteCollection{
</span></span><span style=display:flex><span>    + creteIterator(): Iterator
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>Client --&gt; IterableCollection
</span></span><span style=display:flex><span>Client ---&gt; Iterator
</span></span><span style=display:flex><span>ConcreteIterator ..|&gt; Iterator
</span></span><span style=display:flex><span>ConcreteCollection ..|&gt; IterableCollection
</span></span><span style=display:flex><span>ConcreteIterator &lt;--&gt; ConcreteCollection
</span></span></code></pre></div><ul><li>Iterator 抽象迭代器接口</li><li>IterableCollection 集合返回迭代器接口</li><li>ConcreteIterator 具体迭代器类 需保存遍历进度</li><li>ConcreteIterableCollection 具体返回迭代器类</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/iterator/structure.png alt="iterator structure"></p><h3 id=应用示例-14>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-14></a></h3><p>遍历一个好友关系功能的特殊集合</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Profile{
</span></span><span style=display:flex><span>    + getId()
</span></span><span style=display:flex><span>    + getEmail()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>interface Iterator{
</span></span><span style=display:flex><span>    + getNext: Profile
</span></span><span style=display:flex><span>    + hasMore(): bool
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>interface SocialNetwork{
</span></span><span style=display:flex><span>    + createFriendsIterator(profiledId): ProfileIterator
</span></span><span style=display:flex><span>    + createCoworkersIterator(profiledId): ProfileIterator
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Facebook{
</span></span><span style=display:flex><span>    + createFriendsIterator(profileId): ProfileIterator
</span></span><span style=display:flex><span>    + createCoworkersIterator(profiledId): ProfileIterator
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class FacebookIterator{
</span></span><span style=display:flex><span>    - facebook: Facebook
</span></span><span style=display:flex><span>    - profileId, type
</span></span><span style=display:flex><span>    - currentPosition
</span></span><span style=display:flex><span>    - cache: Profile[]
</span></span><span style=display:flex><span>    + FackbookIterator()
</span></span><span style=display:flex><span>    - lazyInit()
</span></span><span style=display:flex><span>    + getNext(): Profile
</span></span><span style=display:flex><span>    + hasMore(): bool
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class SocialSpammer{
</span></span><span style=display:flex><span>    + send(iterator, message)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Application{
</span></span><span style=display:flex><span>    - spammer
</span></span><span style=display:flex><span>    - network
</span></span><span style=display:flex><span>    + sendSpamToFriends(profile)
</span></span><span style=display:flex><span>    + sendSpanToCoworkers(profile)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Application --&gt; SocialSpammer
</span></span><span style=display:flex><span>Application --&gt; Facebook
</span></span><span style=display:flex><span>SocialSpammer --&gt; Profile
</span></span><span style=display:flex><span>SocialSpammer --&gt; Iterator
</span></span><span style=display:flex><span>Iterator --&gt; Profile
</span></span><span style=display:flex><span>FacebookIterator ..|&gt; Iterator
</span></span><span style=display:flex><span>FacebookIterator &lt;--&gt; Facebook
</span></span><span style=display:flex><span>SocialNetwork --&gt; Iterator
</span></span><span style=display:flex><span>Facebook ..|&gt; SocialNetwork
</span></span><span style=display:flex><span>Facebook o--&gt; Profile
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/iterator/example.png alt="iteartor example"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Profile</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_id</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 抽象社交网络接口</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SocialNetwork</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_friends_iterator</span>(self, profile_id):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_coworkers_iterator</span>(self, profile_id):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 迭代器接口</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProfileIterator</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_next</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>has_more</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 具体迭代器</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FacebookIterator</span>(ProfileIterator):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, facebook, profile_id, type_):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>facebook <span style=color:#f92672>=</span> facebook
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>profile_id <span style=color:#f92672>=</span> profile_id
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>type_ <span style=color:#f92672>=</span> type_
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>current_pos <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cache <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>lazy_init</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> self<span style=color:#f92672>.</span>cache:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>cache <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>facebook<span style=color:#f92672>.</span>social_graph_request(self<span style=color:#f92672>.</span>profile_id, self<span style=color:#f92672>.</span>type_)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_next</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>has_more():
</span></span><span style=display:flex><span>            ret <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>cache[self<span style=color:#f92672>.</span>current_pos]
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>current_pos <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>has_more</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lazy_init()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> len(self<span style=color:#f92672>.</span>cache) <span style=color:#f92672>&gt;</span> self<span style=color:#f92672>.</span>current_pos
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 具体社交类</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Facebook</span>(SocialNetwork):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_friends_iterator</span>(self, profile_id):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> FacebookIterator(self, profile_id, <span style=color:#e6db74>&#39;friends&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_coworkers_iterator</span>(self, profile_id):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> FacebookIterator(self, profile_id, <span style=color:#e6db74>&#39;coworkers&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>social_graph_request</span>(self, profile_id, type_):
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> type_ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;coworkers&#39;</span>:
</span></span><span style=display:flex><span>            ret<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SocialSpammer</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>send</span>(self, iterator, message):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> iterator<span style=color:#f92672>.</span>has_more():
</span></span><span style=display:flex><span>            profile <span style=color:#f92672>=</span> iterator<span style=color:#f92672>.</span>get_next()
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;send email </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(profile))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>network <span style=color:#f92672>=</span> Facebook()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>spammer <span style=color:#f92672>=</span> SocialSpammer()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>send_sapm_to_friends</span>(self, profile):
</span></span><span style=display:flex><span>        iterator <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>network<span style=color:#f92672>.</span>create_friends_iterator(profile<span style=color:#f92672>.</span>get_id())
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>spammer<span style=color:#f92672>.</span>send(iterator, <span style=color:#e6db74>&#39;haha&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>send_spam_to_coworkers</span>(self, profile):
</span></span><span style=display:flex><span>        iterator <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>network<span style=color:#f92672>.</span>create_coworkers_iterator(profile<span style=color:#f92672>.</span>get_id())
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>spammer<span style=color:#f92672>.</span>send(iterator, <span style=color:#e6db74>&#39;haha&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    app <span style=color:#f92672>=</span> Application()
</span></span><span style=display:flex><span>    profile <span style=color:#f92672>=</span> Profile()
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>send_sapm_to_friends(profile)
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>send_spam_to_coworkers(profile)
</span></span></code></pre></div><h3 id=适用性-14>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-14></a></h3><ul><li>集合背后为复杂的数据结构，希望隐藏其复杂性</li><li>减少程序中重复的遍历代码</li><li>希望代码能遍历不同的甚至是无法与之的数据结构</li></ul><h3 id=实现步骤-14>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-14></a></h3><ul><li>声明迭代器接口，至少提供获取下一个元素的方法</li><li>声明集合接口并描述一个获取迭代器的方法</li><li>使用迭代器实现具体的迭代类</li><li>集合中实现集合接口，提供不同创建迭代器的方法</li></ul><h3 id=优缺点-14>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-14></a></h3><ul><li><input checked disabled type=checkbox> 单一职责</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input checked disabled type=checkbox> 并行遍历集合</li><li><input checked disabled type=checkbox> 可暂停后继续遍历集合</li><li><input disabled type=checkbox> 特殊集合迭代器效率低</li></ul><h2 id=中介者模式>中介者模式
<a class=header-anchor href=#%e4%b8%ad%e4%bb%8b%e8%80%85%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-15>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-15></a></h3><p>减少对象之间相互依赖，通过限制对象直接交互，使用中介者进行交互。</p><h3 id=问题-15>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-15></a></h3><p>包含多个组件的对话框进行交互，如果在组件中实现组件之间动态交互与数据的校验等逻辑，会导致代码复杂无法复用。</p><h3 id=解决方案-15>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-15></a></h3><p>中介者模式使组件调用特殊的中介者对象， 通过中介者以间接的方式进行交互。</p><p>上个例子，将对话框作为中介者，所有部件与对话框交互，减少部件之间的依赖。</p><h3 id=uml-结构-15>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-15></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Mediator{
</span></span><span style=display:flex><span>    + notify(sender)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ComponentA{
</span></span><span style=display:flex><span>    - m: Mediator
</span></span><span style=display:flex><span>    + opeartionA()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ComponentB{
</span></span><span style=display:flex><span>    - m: Mediator
</span></span><span style=display:flex><span>    + opeartionB()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteMediator{
</span></span><span style=display:flex><span>    - componentA
</span></span><span style=display:flex><span>    - componentB
</span></span><span style=display:flex><span>    + notify(sender)
</span></span><span style=display:flex><span>    + reactOnA()
</span></span><span style=display:flex><span>    + reactOnB()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ConcreteMediator ..|&gt; Mediator
</span></span><span style=display:flex><span>ConcreteMediator *--&gt; ComponentA
</span></span><span style=display:flex><span>ConcreteMediator *--&gt; ComponentB
</span></span></code></pre></div><ul><li>Mediator 抽象中介者</li><li>ConcreteMediator 具体中介者</li><li>ComponentA 组件</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/mediator/structure.png alt="mediator structure"></p><h3 id=应用示例-15>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-15></a></h3><p>UI 组件交互</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Mediator{
</span></span><span style=display:flex><span>    + notify(sender: Component, event: string)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Component{
</span></span><span style=display:flex><span>    # dialog: Mediator
</span></span><span style=display:flex><span>    + Component(dialog)
</span></span><span style=display:flex><span>    + click()
</span></span><span style=display:flex><span>    + keypress()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class AuthenticationDialog{
</span></span><span style=display:flex><span>    title: string
</span></span><span style=display:flex><span>    loginOrRegister: bool
</span></span><span style=display:flex><span>    loginUsername, loginPassword: Textbox
</span></span><span style=display:flex><span>    regUserame, regPassword, regEmail: Textbox
</span></span><span style=display:flex><span>    ok, cancel: Button
</span></span><span style=display:flex><span>    rememerMe: Checkbox
</span></span><span style=display:flex><span>    + AuthenticationDialog()
</span></span><span style=display:flex><span>    + notify(sender, event)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Checkbox{
</span></span><span style=display:flex><span>    + check()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Button
</span></span><span style=display:flex><span>class Textbox
</span></span><span style=display:flex><span>Button --|&gt; Component
</span></span><span style=display:flex><span>Textbox --|&gt; Component
</span></span><span style=display:flex><span>Checkbox --|&gt; Component
</span></span><span style=display:flex><span>Component &lt;--&gt; Mediator
</span></span><span style=display:flex><span>AuthenticationDialog ..|&gt; Mediator
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- condig: utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 抽象接口</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Mediator</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>notify</span>(self, sender, event):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 具体实现</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthenticationDialog</span>(Mediator):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>title <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>login_or_register_chkbx <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>login_username <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>login_password <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>registration_email <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>registration_password <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>registration_email <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>ok_btn <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cancel_btn <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_chk</span>(self, chk):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>login_or_register_chkbx <span style=color:#f92672>=</span> chk
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>notify</span>(self, sender, event):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> sender <span style=color:#f92672>==</span> self<span style=color:#f92672>.</span>login_or_register_chkbx <span style=color:#f92672>and</span> event <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;check&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>login_or_register_chkbx<span style=color:#f92672>.</span>checked:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>title <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;log in&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>title <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;register&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> sender <span style=color:#f92672>==</span> self<span style=color:#f92672>.</span>ok_btn <span style=color:#f92672>and</span> event <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;click&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>login_or_register<span style=color:#f92672>.</span>checked:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>title <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;click&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>title:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>title))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Component</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, dialog):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>dialog <span style=color:#f92672>=</span> dialog
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>dialog<span style=color:#f92672>.</span>notify(self, <span style=color:#e6db74>&#39;click&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>keypress</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>dialog<span style=color:#f92672>.</span>notify(self, <span style=color:#e6db74>&#39;keypress&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Button</span>(Component):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Textbox</span>(Component):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Checkbox</span>(Component):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>checked <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>dialog<span style=color:#f92672>.</span>notify(self, <span style=color:#e6db74>&#39;check&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    ad <span style=color:#f92672>=</span> AuthenticationDialog()
</span></span><span style=display:flex><span>    btn <span style=color:#f92672>=</span> Button(ad)
</span></span><span style=display:flex><span>    chk <span style=color:#f92672>=</span> Checkbox(ad)
</span></span><span style=display:flex><span>    ad<span style=color:#f92672>.</span>set_chk(chk)
</span></span><span style=display:flex><span>    btn<span style=color:#f92672>.</span>click()
</span></span><span style=display:flex><span>    chk<span style=color:#f92672>.</span>check()
</span></span></code></pre></div><h3 id=适用性-15>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-15></a></h3><ul><li>对象与对象紧密耦合时，使用中介者模式</li><li>组件过于依赖其他组件而无法复用是</li><li>不同场景下复用一些基本行为，导致您需要创建大量组件子类</li></ul><h3 id=实现步骤-15>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-15></a></h3><ul><li>找一组分离有益的耦合类</li><li>声明中介者接口与协议</li><li>实现具体中介者类</li><li>组件必须保存对于中介者对象的引用，构造函数传入</li><li>修改组件代码，使其可调用中介者通知方法，而非其他组件方法</li></ul><h3 id=优缺点-15>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-15></a></h3><ul><li><input checked disabled type=checkbox> 单一职责</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input checked disabled type=checkbox> 减轻组件之间的耦合</li><li><input checked disabled type=checkbox> 复用组件</li><li><input disabled type=checkbox> 中介者过于复杂</li></ul><h2 id=备忘录模式>备忘录模式
<a class=header-anchor href=#%e5%a4%87%e5%bf%98%e5%bd%95%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-16>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-16></a></h3><p>在不暴露对象实现细节的情况下保存和恢复对象之前的状态。</p><h3 id=问题-16>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-16></a></h3><p>文本编辑器除了实现简单的文字编辑还具有图片等多媒体编辑功能，软件需要提供文件的修改历史。编辑器对象需要对所需要的属性进行保存，但是会涉及到对象权限问题。</p><h3 id=解决方案-16>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-16></a></h3><p>备忘录模式将创建状态快照的工作委派给实际状态的拥有者对象。 这样拥有者对象就不再需要暴露私有属性，编辑器类也拥有其状态的完全访问权。</p><p>备忘录模式将对象的副本储存在备忘对象中，除了创建该对象的对象外，任何其他对象都无权访问内容。其他对象必须使用受限接口与备忘录进行交互， 它们可以获取快照的元数据。</p><h3 id=uml-结构-16>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-16></a></h3><h4 id=基于嵌套类实现>基于嵌套类实现
<a class=header-anchor href=#%e5%9f%ba%e4%ba%8e%e5%b5%8c%e5%a5%97%e7%b1%bb%e5%ae%9e%e7%8e%b0></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class Memento{
</span></span><span style=display:flex><span>    - state
</span></span><span style=display:flex><span>    - Memento(state)
</span></span><span style=display:flex><span>    - getState()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Originator{
</span></span><span style=display:flex><span>    + save(): Memento
</span></span><span style=display:flex><span>    + restore(m: Memento)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Caretaker{
</span></span><span style=display:flex><span>    - originator
</span></span><span style=display:flex><span>    - history: Memento[]
</span></span><span style=display:flex><span>    + doSomething()
</span></span><span style=display:flex><span>    + undo()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Originator ..&gt; Memento
</span></span><span style=display:flex><span>Caretaker --&gt; Memento
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/memento/structure1-indexed.png alt="memento structure"></p><ul><li>Originator 原生类 可生成恢复快照</li><li>Memento 备忘录</li><li>Caretaker 负责人 负责状态相关操作</li><li>备忘录嵌套在原生类中</li></ul><h4 id=基于接口实现>基于接口实现
<a class=header-anchor href=#%e5%9f%ba%e4%ba%8e%e6%8e%a5%e5%8f%a3%e5%ae%9e%e7%8e%b0></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Memeto
</span></span><span style=display:flex><span>class ConcreteMemento{
</span></span><span style=display:flex><span>    - state
</span></span><span style=display:flex><span>    + Memento(state)
</span></span><span style=display:flex><span>    + getState()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Originator{
</span></span><span style=display:flex><span>    - state
</span></span><span style=display:flex><span>    + save(): Memento
</span></span><span style=display:flex><span>    + restore(m: Memento)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client{
</span></span><span style=display:flex><span>    - origintor
</span></span><span style=display:flex><span>    - history: Memento[]
</span></span><span style=display:flex><span>    + undo()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ConcreteMemento ..|&gt; Memento
</span></span><span style=display:flex><span>Originator ..&gt; ConcreteMemento
</span></span><span style=display:flex><span>Client --&gt; Memento
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/memento/structure2-indexed.png alt="memento structure"></p><ul><li>负责人仅可通过明确声明的中间接口与备忘录互动， 该接口仅声明与备忘录元数据相关的方法， 限制其对备忘录成员变量的直接访问权限。</li><li>原生类可以直接与备忘录对象进行交互， 访问备忘录类中声明的成员变量和方法。</li></ul><h4 id=严格封装>严格封装
<a class=header-anchor href=#%e4%b8%a5%e6%a0%bc%e5%b0%81%e8%a3%85></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Originator{
</span></span><span style=display:flex><span>    save(): Memento
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>interface Memento{
</span></span><span style=display:flex><span>    + restore()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Caretaker{
</span></span><span style=display:flex><span>    - history: Memento[]
</span></span><span style=display:flex><span>    + undo()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteMemento{
</span></span><span style=display:flex><span>    - originator
</span></span><span style=display:flex><span>    - state
</span></span><span style=display:flex><span>    + Memento(originator, state)
</span></span><span style=display:flex><span>    + restore()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteOriginator{
</span></span><span style=display:flex><span>    - state
</span></span><span style=display:flex><span>    + save(): Memento
</span></span><span style=display:flex><span>    + setState(state)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Originator ..&gt; Memento
</span></span><span style=display:flex><span>ConcreteOriginator ..|&gt; Originator
</span></span><span style=display:flex><span>Caretaker --&gt; Memento
</span></span><span style=display:flex><span>ConcreteMemento ..|&gt; Memento
</span></span><span style=display:flex><span>ConcreteOriginator &lt;--&gt; ConcreteMemento
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/memento/structure3-indexed.png alt="memento structure"></p><h3 id=应用示例-16>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-16></a></h3><p>基于命令模式与备忘录模式，保存复杂文字编辑器的状态快照。</p><p>命令对象作为负责人，执行与命令相关的操作前获取编辑器的备忘录，在撤销时，保存其状态。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Editor</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, text<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, cur_x<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, cur_y<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, selection_width<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>text <span style=color:#f92672>=</span> text
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cur_x <span style=color:#f92672>=</span> cur_x
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cur_y <span style=color:#f92672>=</span> cur_y
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>selection_width <span style=color:#f92672>=</span> selection_width
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_text</span>(self, text):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>text <span style=color:#f92672>=</span> text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_cursor</span>(self, x, y):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cur_x <span style=color:#f92672>=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cur_y <span style=color:#f92672>=</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_selection_width</span>(self, width):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>selection_width <span style=color:#f92672>=</span> width
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_snapshot</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;create snap&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Snapshot(self, self<span style=color:#f92672>.</span>text, self<span style=color:#f92672>.</span>cur_x, self<span style=color:#f92672>.</span>cur_y, self<span style=color:#f92672>.</span>selection_width)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Snapshot</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, editor<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, text<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, cur_x<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, cur_y<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, selection_width<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>editor <span style=color:#f92672>=</span> editor
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>text <span style=color:#f92672>=</span> text
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cur_x <span style=color:#f92672>=</span> cur_x
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cur_y <span style=color:#f92672>=</span> cur_y
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>selection_width <span style=color:#f92672>=</span> selection_width
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>restore</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;restore snap&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>editor<span style=color:#f92672>.</span>set_text(self<span style=color:#f92672>.</span>text)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>editor<span style=color:#f92672>.</span>set_cursor(self<span style=color:#f92672>.</span>cur_x, self<span style=color:#f92672>.</span>cur_y)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>editor<span style=color:#f92672>.</span>set_selection_width(self<span style=color:#f92672>.</span>selection_width)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Command</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, backup<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>backup <span style=color:#f92672>=</span> backup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>make_backup</span>(self, editor):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>backup <span style=color:#f92672>=</span> editor<span style=color:#f92672>.</span>create_snapshot()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>undo</span>(self, editor):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>backup:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>backup<span style=color:#f92672>.</span>restore()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    cmd <span style=color:#f92672>=</span> Command()
</span></span><span style=display:flex><span>    editor <span style=color:#f92672>=</span> Editor(<span style=color:#e6db74>&#39;text&#39;</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    cmd<span style=color:#f92672>.</span>make_backup(editor)
</span></span><span style=display:flex><span>    cmd<span style=color:#f92672>.</span>undo(editor)
</span></span></code></pre></div><h3 id=适用性-16>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-16></a></h3><ul><li>需要创建对象快照恢复其之前的状态</li><li>直接访问对象成员变量破坏封装特性时</li></ul><h3 id=实现步骤-16>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-16></a></h3><ul><li>确认原生类</li><li>创建备忘录类</li><li>将备忘录类设为不可变，备忘录只能通过构造函数一次性接收数据</li><li>可通过嵌套类或接口的方式创建备忘录类的关键关系</li><li>原生类中添加创建备忘录的方法、添加恢复自身状态的方法</li><li>负责人类处理具体如何被触发创建备忘录和恢复备忘录的逻辑</li></ul><h3 id=优缺点-16>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-16></a></h3><ul><li><input checked disabled type=checkbox> 不破坏对象封装情况的前提下创建对象状态快照</li><li><input checked disabled type=checkbox> 通过负责人维护原生类状态历史</li><li><input disabled type=checkbox> 客户端频繁创建备忘录会消耗大量内存</li><li><input disabled type=checkbox> 负责人必须跟踪原生类生命周期，才能销毁不使用的备忘录</li><li><input disabled type=checkbox> 动态编程语言不能确保备忘录状态不能被更改</li></ul><h2 id=观察者模式>观察者模式
<a class=header-anchor href=#%e8%a7%82%e5%af%9f%e8%80%85%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-17>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-17></a></h3><p>允许你定义一种订阅机制， 可在对象事件发生时通知多个 “观察” 该对象的其他对象。</p><h3 id=问题-17>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-17></a></h3><p>商店到货通知，要么让顾客浪费时间检查产品是否到货， 要么让商店浪费资源去通知没有需求的顾客。</p><h3 id=解决方案-17>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-17></a></h3><p>将自身状态改变通知其他对象称为发布者，关注发布者状态变化的称为订阅者。</p><p>发布者实现订阅机制，一、存储订阅者对象引用的列表成员变量，二、实现列表增删的公共方法。</p><p>为了实现通知订阅者，需要订阅者实现相同的接口，以便发布者通过该接口与订阅者交互。</p><h3 id=uml-结构-17>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-17></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Subscriber{
</span></span><span style=display:flex><span>    + update()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Publisher{
</span></span><span style=display:flex><span>    - subscribers: Subscriber[]
</span></span><span style=display:flex><span>    - mainState
</span></span><span style=display:flex><span>    + subscribe(s: Subscriber)
</span></span><span style=display:flex><span>    + unsubscribe(s: Subscriber)
</span></span><span style=display:flex><span>    + notifySubscribers()
</span></span><span style=display:flex><span>    + mainBusinessLogic()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteSubscribers{
</span></span><span style=display:flex><span>    + update(publisher)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ConcreteSubscribers ..|&gt; Subscriber
</span></span><span style=display:flex><span>Publisher o--&gt; Subscriber
</span></span><span style=display:flex><span>Client --&gt; Publisher
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/observer/structure-indexed.png alt="observer structure"></p><ul><li>Publisher 发布者 触发事件</li><li>Subscriber 订阅者 抽象接口</li><li>ConcreteSubscriber 具体订阅者 接收事件</li></ul><h3 id=应用示例-17>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-17></a></h3><p>文本编辑器将自身状态通知其他服务</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface EventListeners{
</span></span><span style=display:flex><span>    + update(filename)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Editor{
</span></span><span style=display:flex><span>    - eventManager
</span></span><span style=display:flex><span>    + Editor()
</span></span><span style=display:flex><span>    + openFile()
</span></span><span style=display:flex><span>    + saveFile()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class EventManager{
</span></span><span style=display:flex><span>    - listeners
</span></span><span style=display:flex><span>    + subscribe(eventType, listener)
</span></span><span style=display:flex><span>    + unsubscribe(eventType, listener)
</span></span><span style=display:flex><span>    + notify(eventType, data)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class EmainAlertsListener{
</span></span><span style=display:flex><span>    + update(filename)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class LogginListener{
</span></span><span style=display:flex><span>    + update(filename)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Editor o--&gt; EventManager
</span></span><span style=display:flex><span>EventManager o--&gt; EventListeners
</span></span><span style=display:flex><span>EmailAlertsListener ..|&gt; EventListeners
</span></span><span style=display:flex><span>LoggingListener ..|&gt; EventListeners
</span></span></code></pre></div><p>只要发布者通过同样的接口与所有订阅者进行交互， 那么在程序中新增订阅者时就无需修改已有发布者类的代码。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/observer/example.png alt="observer example"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> defaultdict
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EventManager</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_listeners <span style=color:#f92672>=</span> defaultdict(list)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>subscribe</span>(self, event_type, listener):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_listeners[event_type]<span style=color:#f92672>.</span>append(listener)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>unsubscribe</span>(self, event_type, listener):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_listeners[event_type]<span style=color:#f92672>.</span>remove(listener)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>notify</span>(self, event_type, data):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>_listeners[event_type]:
</span></span><span style=display:flex><span>            i<span style=color:#f92672>.</span>update(data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Editor</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>file <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>events <span style=color:#f92672>=</span> EventManager()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>open_file</span>(self, path):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>file <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;open file&#39;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>events<span style=color:#f92672>.</span>notify(<span style=color:#e6db74>&#39;open&#39;</span>, self<span style=color:#f92672>.</span>file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>save_file</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>file <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;write file&#39;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>events<span style=color:#f92672>.</span>notify(<span style=color:#e6db74>&#39;save&#39;</span>, self<span style=color:#f92672>.</span>file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EventListener</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>update</span>(self, file_name):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggingListener</span>(EventListener):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, log_file_name, message):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>log <span style=color:#f92672>=</span> log_file_name
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>message <span style=color:#f92672>=</span> message
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>update</span>(self, file_name):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> update&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>log, file_name))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmailAlertsListener</span>(EventListener):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, email, message):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>email <span style=color:#f92672>=</span> email
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>message <span style=color:#f92672>=</span> message
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>update</span>(self, file_name):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> update&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>email, file_name))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    editor <span style=color:#f92672>=</span> Editor()
</span></span><span style=display:flex><span>    logger <span style=color:#f92672>=</span> LoggingListener(<span style=color:#e6db74>&#39;log&#39;</span>, <span style=color:#e6db74>&#39;file 1&#39;</span>)
</span></span><span style=display:flex><span>    editor<span style=color:#f92672>.</span>events<span style=color:#f92672>.</span>subscribe(<span style=color:#e6db74>&#39;open&#39;</span>, logger)
</span></span><span style=display:flex><span>    email <span style=color:#f92672>=</span> EmailAlertsListener(<span style=color:#e6db74>&#39;email&#39;</span>, <span style=color:#e6db74>&#39;haha&#39;</span>)
</span></span><span style=display:flex><span>    editor<span style=color:#f92672>.</span>events<span style=color:#f92672>.</span>subscribe(<span style=color:#e6db74>&#39;save&#39;</span>, email)
</span></span><span style=display:flex><span>    editor<span style=color:#f92672>.</span>open_file(<span style=color:#e6db74>&#39;file2&#39;</span>)
</span></span><span style=display:flex><span>    editor<span style=color:#f92672>.</span>save_file()
</span></span></code></pre></div><h3 id=适用性-17>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-17></a></h3><ul><li>当一个对象状态的改变需要改变其他对象，或实际对象是事先未知的或动态变化的，可以使用观察者模式</li><li>当应用中的一些对象必须观察其他对象是，可以使用该模式</li></ul><h3 id=实现步骤-17>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-17></a></h3><ul><li>声明订阅者接口，至少声明一个 update 方法</li><li>声明发布者接口并定义一些接口来管理订阅对象</li><li>实现订阅方法</li><li>创建发布者类，每次事件发生需要通知订阅者</li><li>在具体订阅类中实现通知更新的方法</li><li>客户端必须生成全部订阅者，并在相应的发布者处完成注册工作</li></ul><h3 id=优缺点-17>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-17></a></h3><ul><li><input checked disabled type=checkbox> 开闭原则</li><li><input checked disabled type=checkbox> 可以运行时建立对象之间的联系</li><li><input disabled type=checkbox> 订阅者的通知顺序是随机的</li></ul><h2 id=状态模式>状态模式
<a class=header-anchor href=#%e7%8a%b6%e6%80%81%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-18>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-18></a></h3><p>当对象的内部状态变化时改变其行为， 使其看上去就像改变了自身所属的类一样。</p><h3 id=问题-18>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-18></a></h3><p>相近概念：有限状态机</p><p>程序在任何时刻仅可处于几种有限的状态中，在任何一个特定状态中，程序的行为都不相同， 且可瞬间从一个状态切换到另一个状态。</p><p>基于条件语句的状态机，为了能根据当前状态选择完成相应行为的方法会包含复杂的条件语句。 修改其转换逻辑可能会涉及到修改所有方法中的状态条件语句， 导致代码的维护工作非常艰难。</p><h3 id=解决方案-18>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-18></a></h3><p>创建包含所有状态的类，然后将所有状态的对应行为抽取到这些类中。原始对象作为上下文对象，保存指向状态对象的引用，且将所有与状态相关的工作委派给该对象。</p><h3 id=uml-结构-18>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-18></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface State{
</span></span><span style=display:flex><span>    + doThis()
</span></span><span style=display:flex><span>    + doThat()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteStates{
</span></span><span style=display:flex><span>    - context
</span></span><span style=display:flex><span>    + setContext(context)
</span></span><span style=display:flex><span>    + doThis()
</span></span><span style=display:flex><span>    + doThat()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Context{
</span></span><span style=display:flex><span>    - state
</span></span><span style=display:flex><span>    + Context(initialState)
</span></span><span style=display:flex><span>    + changeState(state)
</span></span><span style=display:flex><span>    + doThis()
</span></span><span style=display:flex><span>    + doThat()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>Client --&gt; Context
</span></span><span style=display:flex><span>Client --&gt; ConcreteStates
</span></span><span style=display:flex><span>ConcreteStates --|&gt; State
</span></span><span style=display:flex><span>ConcreteStates --&gt; Context
</span></span><span style=display:flex><span>Context o--&gt; State
</span></span></code></pre></div><ul><li>State 抽象状态接口</li><li>ConcreteStates 具体状态类 包含所有需要状态</li><li>Context 上下文 切换状态</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/state/structure.png alt="state structure"></p><h3 id=应用示例-18>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-18></a></h3><p>状态模式将根据当前回放状态， 让媒体播放器中的相同控件完成不同的行为。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class State{
</span></span><span style=display:flex><span>    - player
</span></span><span style=display:flex><span>    + State(player)
</span></span><span style=display:flex><span>    + clickLock()
</span></span><span style=display:flex><span>    + clickPlay()
</span></span><span style=display:flex><span>    + clickNext()
</span></span><span style=display:flex><span>    + clickPrevious()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Player{
</span></span><span style=display:flex><span>    - state
</span></span><span style=display:flex><span>    + UI,volume,playlist,currentSong
</span></span><span style=display:flex><span>    + Player()
</span></span><span style=display:flex><span>    + changeState(state)
</span></span><span style=display:flex><span>    + clickLock()
</span></span><span style=display:flex><span>    + clickPlay()
</span></span><span style=display:flex><span>    + clickNext()
</span></span><span style=display:flex><span>    + clickPrevious()
</span></span><span style=display:flex><span>    + startPlayback()
</span></span><span style=display:flex><span>    + stopPlayback()
</span></span><span style=display:flex><span>    + nextSong()
</span></span><span style=display:flex><span>    + previousSong()
</span></span><span style=display:flex><span>    + fastForward()
</span></span><span style=display:flex><span>    + rewind()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>Player o--&gt; State
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AudioPlay</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>state <span style=color:#f92672>=</span> ReadyState(self)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>UI <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UI&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>change_state</span>(self, state):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>state <span style=color:#f92672>=</span> state
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_lock</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>state<span style=color:#f92672>.</span>click_lock()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_play</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>state<span style=color:#f92672>.</span>click_play()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_next</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>state<span style=color:#f92672>.</span>click_next()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_previous</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>state<span style=color:#f92672>.</span>click_previous()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>State</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, player):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>player <span style=color:#f92672>=</span> player
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_lock</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_play</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_next</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_previous</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LockedState</span>(State):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_lock</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>player<span style=color:#f92672>.</span>playing:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>player<span style=color:#f92672>.</span>change_state(PlayingState(self<span style=color:#f92672>.</span>player))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>player<span style=color:#f92672>.</span>change_state(ReadyState(self<span style=color:#f92672>.</span>player))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_next</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> super()<span style=color:#f92672>.</span>click_next()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_play</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> super()<span style=color:#f92672>.</span>click_play()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_previous</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> super()<span style=color:#f92672>.</span>click_previous()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReadyState</span>(State):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_lock</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>player<span style=color:#f92672>.</span>change_state(LockedState(self<span style=color:#f92672>.</span>player))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_next</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;next song&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_previous</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;previous song&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_play</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;play song&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PlayingState</span>(State):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_lock</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>player<span style=color:#f92672>.</span>change_state(LockedState(self<span style=color:#f92672>.</span>player))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_play</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;stop play&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>player<span style=color:#f92672>.</span>change_state(ReadyState(self<span style=color:#f92672>.</span>player))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_next</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;next song&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>click_previous</span>(self):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;previous song&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    play <span style=color:#f92672>=</span> AudioPlay()
</span></span><span style=display:flex><span>    play<span style=color:#f92672>.</span>click_next()
</span></span><span style=display:flex><span>    play<span style=color:#f92672>.</span>click_previous()
</span></span><span style=display:flex><span>    play<span style=color:#f92672>.</span>click_play()
</span></span><span style=display:flex><span>    play<span style=color:#f92672>.</span>click_lock()
</span></span><span style=display:flex><span>    play<span style=color:#f92672>.</span>click_next()
</span></span><span style=display:flex><span>    play<span style=color:#f92672>.</span>click_previous()
</span></span><span style=display:flex><span>    play<span style=color:#f92672>.</span>click_play()
</span></span></code></pre></div><h3 id=适用性-18>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-18></a></h3><ul><li>如果对象需要根据自身当前状态进行不同行为，同时状态的数量非常多且与状态相关的代码会频繁变更</li><li>如果某个类需要根据成员变量的当前值改变自身行为，需要使用大量的条件语句</li><li>当相似状态和基于条件的状态机转换中存在许多重复代码</li></ul><h3 id=实现步骤-18>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-18></a></h3><ul><li><p>确认上下文类</p></li><li><p>声明状态接口</p></li><li><p>实现特定状态的具体类</p><ul><li>这些成员变量或方法设为公有。</li><li>将需要抽取的上下文行为更改为上下文中的公有方法， 然后在状态类中调用。</li><li>将状态类嵌套在上下文类中。</li></ul></li><li><p>上下文类中添加一个状态接口类型的引用成员变量， 以及一个用于修改该成员变量值的公有接口。</p></li></ul><h3 id=优缺点-18>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-18></a></h3><ul><li><input checked disabled type=checkbox> 单一职责原则</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input checked disabled type=checkbox> 消除臃肿的状态机条件语句简化上下文代码</li><li><input disabled type=checkbox> 状态机只有很少的几个状态， 或者很少发生改变， 那么应用该模式可能会显得小题大作</li></ul><h2 id=策略模式>策略模式
<a class=header-anchor href=#%e7%ad%96%e7%95%a5%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-19>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-19></a></h3><p>定义一系列算法， 并将每种算法分别放入独立的类中， 以使算法的对象能够相互替换。</p><h3 id=问题-19>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-19></a></h3><p>实现自动导航的导游程序，首次实现了公交版的路线规划，随后增加了骑行者者版本的路线规划，随着需求越来越多，代码量增加可维护性下降。</p><h3 id=解决方案-19>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-19></a></h3><p>策略模式找出负责用许多不同方式完成特定任务的类， 然后将其中的算法抽取到一组被称为策略的独立类中。</p><p>上下文的原始类必须包含一个成员变量来存储对于每种策略的引用。 上下文并不执行任务， 而是将工作委派给已连接的策略对象。</p><h3 id=uml-结构-19>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-19></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Strategy{
</span></span><span style=display:flex><span>    + execute(data)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteStrategies{
</span></span><span style=display:flex><span>    + execute(data)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Context{
</span></span><span style=display:flex><span>    - strategy
</span></span><span style=display:flex><span>    + setStrategy(strategy)
</span></span><span style=display:flex><span>    + doSomething()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>Client --&gt; Context
</span></span><span style=display:flex><span>Client --&gt; ConcreteStrategies
</span></span><span style=display:flex><span>Context o--&gt; Strategy
</span></span><span style=display:flex><span>ConcreteStrategies ..|&gt; Strategy
</span></span></code></pre></div><ul><li>Strategy 抽象策略类</li><li>ConcreteStrategies 具体策略类</li><li>Context 上下文 维护指向具体策略的引用，上下文不清楚其所涉及的策略类型与算法的执行方式</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/strategy/structure.png alt="strategy structure"></p><h3 id=应用示例-19>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-19></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Strategy</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ConcreteStrategyAdd</span>(Strategy):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> args:
</span></span><span style=display:flex><span>            ret <span style=color:#f92672>+=</span> int(i)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ConcreteStrategySubtract</span>(Strategy):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> args[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> args[<span style=color:#ae81ff>1</span>:]:
</span></span><span style=display:flex><span>            ret <span style=color:#f92672>-=</span> int(i)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ConcreteStrategyMultiply</span>(Strategy):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute</span>(self, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> args:
</span></span><span style=display:flex><span>            ret <span style=color:#f92672>*=</span> int(i)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Context</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, strategy<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>strategy <span style=color:#f92672>=</span> strategy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>set_strategy</span>(self, strategy):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>strategy <span style=color:#f92672>=</span> strategy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>execute_strategy</span>(self, <span style=color:#f92672>*</span>args):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>strategy<span style=color:#f92672>.</span>execute(<span style=color:#f92672>*</span>args)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    a <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>    b <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    context <span style=color:#f92672>=</span> Context()
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>set_strategy(ConcreteStrategyAdd())
</span></span><span style=display:flex><span>    print(context<span style=color:#f92672>.</span>execute_strategy(a, b))
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>set_strategy(ConcreteStrategySubtract())
</span></span><span style=display:flex><span>    print(context<span style=color:#f92672>.</span>execute_strategy(a, b))
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>set_strategy(ConcreteStrategyMultiply())
</span></span><span style=display:flex><span>    print(context<span style=color:#f92672>.</span>execute_strategy(a, b))
</span></span></code></pre></div><h3 id=适用性-19>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-19></a></h3><ul><li>当你想使用对象中各种不同的算法变体， 并希望能在运行时切换算法时， 可使用策略模式。</li><li>当你有许多仅在执行某些行为时略有不同的相似类时， 可使用策略模式。</li><li>如果算法在逻辑的上下文中不是特别重要， 使用该模式能将类的业务逻辑与其算法实现细节隔离开来。</li><li>当类中使用了复杂条件运算符以在同一算法的不同变体中切换时， 可使用该模式。</li></ul><h3 id=实现步骤-19>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-19></a></h3><ul><li>上下文中修改频率较高的算法</li><li>声明该算法的通用接口</li><li>实现具体策略类</li><li>上下文类中添加一个成员变量用于保存对于策略对象的引用。 然后提供设置方法</li></ul><h3 id=优缺点-19>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-19></a></h3><ul><li><input checked disabled type=checkbox> 在运行时切换对象内的算法。</li><li><input checked disabled type=checkbox> 将算法的实现和使用算法的代码隔离开来。</li><li><input checked disabled type=checkbox> 使用组合来代替继承。</li><li><input checked disabled type=checkbox> 开闭原则</li><li><input disabled type=checkbox> 如果你的算法极少发生改变， 那么没有任何理由引入新的类和接口。</li><li><input disabled type=checkbox> 客户端必须知晓策略间的不同——它需要选择合适的策略。</li><li><input disabled type=checkbox> 许多现代编程语言支持函数类型功能， 允许你在一组匿名函数中实现不同版本的算法。</li></ul><h2 id=模版方法模式>模版方法模式
<a class=header-anchor href=#%e6%a8%a1%e7%89%88%e6%96%b9%e6%b3%95%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-20>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-20></a></h3><p>超类中定义了一个算法的框架， 允许子类在不修改结构的情况下重写算法的特定步骤。</p><h3 id=问题-20>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-20></a></h3><p>编写文档数据提取工具，首个版本仅支持 DOC 文件，随后增加了 CSV、PDF 文件的支持。</p><p>发现这三个类中包含许多相似代码。 尽管这些类处理不同数据格式的代码完全不同， 但数据处理和分析的代码却几乎完全一样。并且客户端中包含了很多条件语句。</p><h3 id=解决方案-20>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-20></a></h3><p>模板方法模式建议将算法分解为一系列步骤， 然后将这些步骤改写为方法， 最后在 “模板方法” 中依次调用这些方法。步骤可以是抽象的， 也可以有一些默认的实现。为了能够使用算法， 客户端需要自行提供子类并实现所有的抽象步骤。 如有必要还需重写一些步骤（不包括模板方法）。</p><h3 id=uml-结构-20>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-20></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>class AbstractClass{
</span></span><span style=display:flex><span>    + templateMethod()
</span></span><span style=display:flex><span>    + step1()
</span></span><span style=display:flex><span>    + step2()
</span></span><span style=display:flex><span>    + step3()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteClass1{
</span></span><span style=display:flex><span>    + step2()
</span></span><span style=display:flex><span>    + step3()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteClass2{
</span></span><span style=display:flex><span>    + step1()
</span></span><span style=display:flex><span>    + step2()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ConcreteClass1 --|&gt; AbstractClass
</span></span><span style=display:flex><span>ConcreteClass2 --|&gt; AbstractClass
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/template-method/structure.png alt="tempalte method structure"></p><h3 id=应用示例-20>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-20></a></h3><p>AI 策略类游戏</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GameAI</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_structures</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_units</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>send_scouts</span>(self, position):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>send_warriors</span>(self, position):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>closest_enemy</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>collection_resources</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>build_structures():
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;collection </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(i))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>attack</span>(self):
</span></span><span style=display:flex><span>        enemy <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>closest_enemy()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> enemy:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>send_warriors(<span style=color:#e6db74>&#39;x1&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>send_scouts(<span style=color:#e6db74>&#39;y1&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>turn</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># template method</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>collection_resources()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>build_structures()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>build_units()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>attack()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrcsAI</span>(GameAI):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_structures</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_units</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [<span style=color:#e6db74>&#39;u1&#39;</span>, <span style=color:#e6db74>&#39;u2&#39;</span>, <span style=color:#e6db74>&#39;u3&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>send_scouts</span>(self, position):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74> send scouts to </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, position))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>send_warriors</span>(self, position):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74> send warriors to </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, position))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MonstersAI</span>(GameAI):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>collection_resources</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_structures</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_units</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    orcs_ai <span style=color:#f92672>=</span> OrcsAI()
</span></span><span style=display:flex><span>    orcs_ai<span style=color:#f92672>.</span>turn()
</span></span><span style=display:flex><span>    monsters_ai <span style=color:#f92672>=</span> MonstersAI()
</span></span><span style=display:flex><span>    monsters_ai<span style=color:#f92672>.</span>turn()
</span></span></code></pre></div><h3 id=适用性-20>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-20></a></h3><ul><li>希望客户端扩展某个特定算法步骤， 而不是整个算法或其结构</li><li>多个类的算法除一些细微不同之外几乎完全一样时， 你可使用该模式。 但其后果就是， 只要算法发生变化， 你就可能需要修改所有的类。</li></ul><h3 id=实现步骤-20>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-20></a></h3><ul><li>分析目标算法， 确定能否将其分解为多个步骤</li><li>创建抽象基类并声明一个模板方法和代表算法步骤的一系列抽象方法</li><li>可考虑在算法的关键步骤之间添加钩子，改变算法流程</li><li>为每个算法变体新建一个具体子类， 实现抽象步骤</li></ul><h3 id=优缺点-20>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-20></a></h3><ul><li><input checked disabled type=checkbox> 允许客户端重写一个大型算法中的特定部分</li><li><input checked disabled type=checkbox> 将重复代码提取到一个超类中</li><li><input disabled type=checkbox> 部分客户端可能会受到算法框架的限制</li><li><input disabled type=checkbox> 违反里氏替换原则</li><li><input disabled type=checkbox> 模板方法中的步骤越多， 其维护工作就可能会越困难</li></ul><h2 id=访问者模式>访问者模式
<a class=header-anchor href=#%e8%ae%bf%e9%97%ae%e8%80%85%e6%a8%a1%e5%bc%8f></a></h2><h3 id=意图-21>意图
<a class=header-anchor href=#%e6%84%8f%e5%9b%be-21></a></h3><p>访问者的目的是让你能为整个类层次结构添加 “外部” 操作， 而无需修改这些类的已有代码。</p><h3 id=问题-21>问题
<a class=header-anchor href=#%e9%97%ae%e9%a2%98-21></a></h3><p>已有的地图产品需要实现地图节点 XML 导出模块，可以修改原有的类实现导出功能，但是可能引入潜在的风险</p><h3 id=解决方案-21>解决方案
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-21></a></h3><p>访问者模式建议将新行为放入一个名为访问者的独立类中， 而不是试图将其整合到已有类中。 现在， 需要执行操作的原始对象将作为参数被传递给访问者中的方法， 让方法能访问对象所包含的一切必要数据。</p><p>访问者类访问不同的节点对象时，由于节点对象各自处理方法不同，需要进行判断。访问模式实现了双分派技巧，将处理的方法委派给作为参数传递给访问者的节点对象</p><h3 id=uml-结构-21>UML 结构
<a class=header-anchor href=#uml-%e7%bb%93%e6%9e%84-21></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Visitor{
</span></span><span style=display:flex><span>    + visit(e: ElementA)
</span></span><span style=display:flex><span>    + visit(e: ElementB)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>interface Element{
</span></span><span style=display:flex><span>    + accept(v: Visitor)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ElementA{
</span></span><span style=display:flex><span>    + featureA()
</span></span><span style=display:flex><span>    + accept(v: Visitor)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ElementB{
</span></span><span style=display:flex><span>    + featureB()
</span></span><span style=display:flex><span>    + accept(v: Visitor)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class ConcreteVisitors{
</span></span><span style=display:flex><span>    + visit(e: ElementA)
</span></span><span style=display:flex><span>    + visit(e: ElementB)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Client
</span></span><span style=display:flex><span>Client --&gt; ConcreteVisitors
</span></span><span style=display:flex><span>Client --&gt; Element
</span></span><span style=display:flex><span>Element --&gt; Visitor
</span></span><span style=display:flex><span>Visitor --&gt; ElementA
</span></span><span style=display:flex><span>Visitor --&gt; ElementB
</span></span><span style=display:flex><span>ConcreteVisitors ..|&gt; Visitor
</span></span><span style=display:flex><span>ElementA ..|&gt; Element
</span></span><span style=display:flex><span>ElementB ..|&gt; Element
</span></span></code></pre></div><ul><li>Visitor 抽象接口声明节点对象访问方法</li><li>Element 抽象节点声明接收访问者的方法</li><li>ElementA 具体节点类</li><li>ConcreteVisitors 具体访问者</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/visitor/structure.png alt="visitor structure"></p><h3 id=应用示例-21>应用示例
<a class=header-anchor href=#%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b-21></a></h3><p>几何图像层次结构添加了对于 XML 文件导出功能</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface Visitor{
</span></span><span style=display:flex><span>    + visitDot(d: Dot)
</span></span><span style=display:flex><span>    + visitCircle(c: Circle)
</span></span><span style=display:flex><span>    + visitRectangle(r: Rectangle)
</span></span><span style=display:flex><span>    + visitCompundGraphic(cs: CompoundGraphic)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>interface Shape{
</span></span><span style=display:flex><span>    + move(x, y)
</span></span><span style=display:flex><span>    + draw()
</span></span><span style=display:flex><span>    + accept(v: Visitor)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Dot
</span></span><span style=display:flex><span>class Circle
</span></span><span style=display:flex><span>class Rectangle
</span></span><span style=display:flex><span>class CompundGraphic
</span></span><span style=display:flex><span>class XMLExportVisitor{
</span></span><span style=display:flex><span>    + visitDot(d: Dot)
</span></span><span style=display:flex><span>    + visitCircle(c: Circle)
</span></span><span style=display:flex><span>    + visitRectangle(r: Rectangle)
</span></span><span style=display:flex><span>    + visitCompundGraphic(cs: CompoundGraphic)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>class Application
</span></span><span style=display:flex><span>Application --&gt; XMLExportVisitor
</span></span><span style=display:flex><span>Application --&gt; Shape
</span></span><span style=display:flex><span>Shape --&gt; Visitor
</span></span><span style=display:flex><span>Visitor --&gt; Dot
</span></span><span style=display:flex><span>Visitor --&gt; Circle
</span></span><span style=display:flex><span>Visitor --&gt; Rectangle
</span></span><span style=display:flex><span>Visitor --&gt; CompundGraphic
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://refactoring.guru/images/patterns/diagrams/visitor/example.png alt="visitor example">
<a href=https://refactoring.guru/design-patterns/visitor-double-dispatch title="visitor and double dispatch" rel="noopener external nofollow noreferrer" target=_blank class=exturl>visitor and double dispatch
<i class="fa fa-external-link-alt"></i></a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABCMeta, abstractmethod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Shape</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># @abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># def move(self, x, y):</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># @abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># def draw(self):</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>accept</span>(self, visitor):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Visitor</span>(metaclass<span style=color:#f92672>=</span>ABCMeta):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>visitDot</span>(self, shape):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>visitCircle</span>(self, shape):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>visitRectangle</span>(self, shape):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>visitCompoundShape</span>(self, shape):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dot</span>(Shape):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>accept</span>(self, visitor):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;class: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, visitor: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, visitor))
</span></span><span style=display:flex><span>        visitor<span style=color:#f92672>.</span>visitDot(self)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Circle</span>(Shape):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>accept</span>(self, visitor):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;class: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, visitor: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, visitor))
</span></span><span style=display:flex><span>        visitor<span style=color:#f92672>.</span>visitCircle(self)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Rectangle</span>(Shape):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>accept</span>(self, visitor):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;class: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, visitor: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, visitor))
</span></span><span style=display:flex><span>        visitor<span style=color:#f92672>.</span>visitRectangle(self)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CompoundShape</span>(Shape):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>accept</span>(self, visitor):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;class: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, visitor: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, visitor))
</span></span><span style=display:flex><span>        visitor<span style=color:#f92672>.</span>visitCompoundShape(self)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>XMLExportVisitor</span>(Visitor):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>visitDot</span>(self, shape):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;class: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, self: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, self))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>visitCircle</span>(self, shape):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;class: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, self: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, self))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>visitRectangle</span>(self, shape):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>visitRectangle(shape)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;class: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, self: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, self))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>visitCompoundShape</span>(self, shape):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>visitCompoundShape(shape)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;class: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, self: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__, self))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    export_visitor <span style=color:#f92672>=</span> XMLExportVisitor()
</span></span><span style=display:flex><span>    shapes <span style=color:#f92672>=</span> [Dot(), Circle(), Rectangle(), CompoundShape()]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> shape <span style=color:#f92672>in</span> shapes:
</span></span><span style=display:flex><span>        shape<span style=color:#f92672>.</span>accept(export_visitor)
</span></span></code></pre></div><h3 id=适用性-21>适用性
<a class=header-anchor href=#%e9%80%82%e7%94%a8%e6%80%a7-21></a></h3><ul><li>对一个复杂对象结构 （例如对象树） 中的所有元素执行某些操作， 可使用访问者模式。</li><li>可使用访问者模式来清理辅助行为的业务逻辑。</li><li>当某个行为仅在类层次结构中的一些类中有意义， 而在其他类中没有意义时， 可使用该模式。</li></ul><h3 id=实现步骤-21>实现步骤
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4-21></a></h3><ul><li>在访问者接口中声明一组 “访问” 方法， 分别对应程序中的每个具体元素类。</li><li>声明元素接口，该方法必须接受访问者对象作为参数。</li><li>在所有具体元素类中实现接收方法。 这些方法必须将调用重定向到当前元素对应的访问者对象中的访问者方法上。</li><li>元素类只能通过访问者接口与访问者进行交互。</li><li>为每个无法在元素层次结构中实现的行为创建一个具体访问者类并实现所有的访问者方法。</li></ul><h3 id=优缺点-21>优缺点
<a class=header-anchor href=#%e4%bc%98%e7%bc%ba%e7%82%b9-21></a></h3><ul><li><input checked disabled type=checkbox> 开闭原则</li><li><input checked disabled type=checkbox> 单一职责原则</li><li><input disabled type=checkbox> 访问者对象可以在与各种对象交互时收集一些有用的信息。</li><li><input disabled type=checkbox> 每次在元素层次结构中添加或移除一个类时， 你都要更新所有的访问者。</li><li><input disabled type=checkbox> 在访问者同某个元素进行交互时， 它们可能没有访问元素私有成员变量和方法的必要权限。</li></ul><h1 id=reference>Reference
<a class=header-anchor href=#reference></a></h1><ul><li><a href=https://python-patterns.guide/ title="python pattern" rel="noopener external nofollow noreferrer" target=_blank class=exturl>python pattern
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://refactoring.guru/design-patterns title="refactor guru" rel="noopener external nofollow noreferrer" target=_blank class=exturl>refactor guru
<i class="fa fa-external-link-alt"></i></a></li></ul></div><footer class=post-footer><div class=post-tags><a href=/tags/python>python
</a><a href=/tags/uml>uml
</a><a href=/tags/design-pattern>design pattern</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
设计模式</li><li class=post-copyright-author><strong>本文作者： </strong>cnewbie</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://cnewbie.github.io/posts/oop-design-pattern/ title=设计模式>https://cnewbie.github.io/posts/oop-design-pattern/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/rss.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/posts/algorithm-binary-search/ rel=next title="Binary Search"><i class="fa fa-chevron-left"></i> Binary Search</a></div><div class="post-nav-prev post-nav-item"><a href=/posts/python-cookbook/ rel=prev title="Python Cookbook">Python Cookbook
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>cnewbie</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.121.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"cnewbie/cnewbie.github.io","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://cnewbie.github.io","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.b0c78e5a4df586ee46d02716ffa91a4a322e56763e04e91eb2ba052c9469ed02.js defer></script></body></html>